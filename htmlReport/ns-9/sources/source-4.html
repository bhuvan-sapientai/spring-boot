


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > Library</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.springframework.boot.build.bom</a>
</div>

<h1>Coverage Summary for Class: Library (org.springframework.boot.build.bom)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Library</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
</tr>
  <tr>
    <td class="name">Library$Exclusion</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Library$Group</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Library$LibraryVersion</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Library$Module</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Library$ProhibitedVersion</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">Library$VersionAlignment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/54)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/42)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/119)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * Copyright 2012-2024 the original author or authors.
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *      https://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;
&nbsp;package org.springframework.boot.build.bom;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Collections;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.List;
&nbsp;import java.util.Locale;
&nbsp;import java.util.Map;
&nbsp;import java.util.Set;
&nbsp;
&nbsp;import org.apache.maven.artifact.versioning.DefaultArtifactVersion;
&nbsp;import org.apache.maven.artifact.versioning.VersionRange;
&nbsp;import org.gradle.api.Project;
&nbsp;import org.gradle.api.artifacts.Configuration;
&nbsp;import org.gradle.api.artifacts.Dependency;
&nbsp;import org.gradle.api.artifacts.dsl.DependencyHandler;
&nbsp;import org.gradle.api.artifacts.result.DependencyResult;
&nbsp;
&nbsp;import org.springframework.boot.build.bom.bomr.version.DependencyVersion;
&nbsp;
&nbsp;/**
&nbsp; * A collection of modules, Maven plugins, and Maven boms that are versioned and released
&nbsp; * together.
&nbsp; *
&nbsp; * @author Andy Wilkinson
&nbsp; */
&nbsp;public class Library {
&nbsp;
&nbsp;	private final String name;
&nbsp;
&nbsp;	private final String calendarName;
&nbsp;
&nbsp;	private final LibraryVersion version;
&nbsp;
&nbsp;	private final List&lt;Group&gt; groups;
&nbsp;
&nbsp;	private final String versionProperty;
&nbsp;
&nbsp;	private final List&lt;ProhibitedVersion&gt; prohibitedVersions;
&nbsp;
&nbsp;	private final boolean considerSnapshots;
&nbsp;
&nbsp;	private final VersionAlignment versionAlignment;
&nbsp;
&nbsp;	/**
&nbsp;	 * Create a new {@code Library} with the given {@code name}, {@code version}, and
&nbsp;	 * {@code groups}.
&nbsp;	 * @param name name of the library
&nbsp;	 * @param calendarName name of the library as it appears in the Spring Calendar. May
&nbsp;	 * be {@code null} in which case the {@code name} is used.
&nbsp;	 * @param version version of the library
&nbsp;	 * @param groups groups in the library
&nbsp;	 * @param prohibitedVersions version of the library that are prohibited
&nbsp;	 * @param considerSnapshots whether to consider snapshots
&nbsp;	 * @param versionAlignment version alignment, if any, for the library
&nbsp;	 */
&nbsp;	public Library(String name, String calendarName, LibraryVersion version, List&lt;Group&gt; groups,
<b class="nc">&nbsp;			List&lt;ProhibitedVersion&gt; prohibitedVersions, boolean considerSnapshots, VersionAlignment versionAlignment) {</b>
<b class="nc">&nbsp;		this.name = name;</b>
<b class="nc">&nbsp;		this.calendarName = (calendarName != null) ? calendarName : name;</b>
<b class="nc">&nbsp;		this.version = version;</b>
<b class="nc">&nbsp;		this.groups = groups;</b>
<b class="nc">&nbsp;		this.versionProperty = &quot;Spring Boot&quot;.equals(name) ? null</b>
<b class="nc">&nbsp;				: name.toLowerCase(Locale.ENGLISH).replace(&#39; &#39;, &#39;-&#39;) + &quot;.version&quot;;</b>
<b class="nc">&nbsp;		this.prohibitedVersions = prohibitedVersions;</b>
<b class="nc">&nbsp;		this.considerSnapshots = considerSnapshots;</b>
<b class="nc">&nbsp;		this.versionAlignment = versionAlignment;</b>
&nbsp;	}
&nbsp;
&nbsp;	public String getName() {
<b class="nc">&nbsp;		return this.name;</b>
&nbsp;	}
&nbsp;
&nbsp;	public String getCalendarName() {
<b class="nc">&nbsp;		return this.calendarName;</b>
&nbsp;	}
&nbsp;
&nbsp;	public LibraryVersion getVersion() {
<b class="nc">&nbsp;		return this.version;</b>
&nbsp;	}
&nbsp;
&nbsp;	public List&lt;Group&gt; getGroups() {
<b class="nc">&nbsp;		return this.groups;</b>
&nbsp;	}
&nbsp;
&nbsp;	public String getVersionProperty() {
<b class="nc">&nbsp;		return this.versionProperty;</b>
&nbsp;	}
&nbsp;
&nbsp;	public List&lt;ProhibitedVersion&gt; getProhibitedVersions() {
<b class="nc">&nbsp;		return this.prohibitedVersions;</b>
&nbsp;	}
&nbsp;
&nbsp;	public boolean isConsiderSnapshots() {
<b class="nc">&nbsp;		return this.considerSnapshots;</b>
&nbsp;	}
&nbsp;
&nbsp;	public VersionAlignment getVersionAlignment() {
<b class="nc">&nbsp;		return this.versionAlignment;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * A version or range of versions that are prohibited from being used in a bom.
&nbsp;	 */
&nbsp;	public static class ProhibitedVersion {
&nbsp;
&nbsp;		private final VersionRange range;
&nbsp;
&nbsp;		private final List&lt;String&gt; startsWith;
&nbsp;
&nbsp;		private final List&lt;String&gt; endsWith;
&nbsp;
&nbsp;		private final List&lt;String&gt; contains;
&nbsp;
&nbsp;		private final String reason;
&nbsp;
&nbsp;		public ProhibitedVersion(VersionRange range, List&lt;String&gt; startsWith, List&lt;String&gt; endsWith,
<b class="nc">&nbsp;				List&lt;String&gt; contains, String reason) {</b>
<b class="nc">&nbsp;			this.range = range;</b>
<b class="nc">&nbsp;			this.startsWith = startsWith;</b>
<b class="nc">&nbsp;			this.endsWith = endsWith;</b>
<b class="nc">&nbsp;			this.contains = contains;</b>
<b class="nc">&nbsp;			this.reason = reason;</b>
&nbsp;		}
&nbsp;
&nbsp;		public VersionRange getRange() {
<b class="nc">&nbsp;			return this.range;</b>
&nbsp;		}
&nbsp;
&nbsp;		public List&lt;String&gt; getStartsWith() {
<b class="nc">&nbsp;			return this.startsWith;</b>
&nbsp;		}
&nbsp;
&nbsp;		public List&lt;String&gt; getEndsWith() {
<b class="nc">&nbsp;			return this.endsWith;</b>
&nbsp;		}
&nbsp;
&nbsp;		public List&lt;String&gt; getContains() {
<b class="nc">&nbsp;			return this.contains;</b>
&nbsp;		}
&nbsp;
&nbsp;		public String getReason() {
<b class="nc">&nbsp;			return this.reason;</b>
&nbsp;		}
&nbsp;
&nbsp;		public boolean isProhibited(String candidate) {
<b class="nc">&nbsp;			boolean result = false;</b>
<b class="nc">&nbsp;			result = result</b>
<b class="nc">&nbsp;					|| (this.range != null &amp;&amp; this.range.containsVersion(new DefaultArtifactVersion(candidate)));</b>
<b class="nc">&nbsp;			result = result || this.startsWith.stream().anyMatch(candidate::startsWith);</b>
<b class="nc">&nbsp;			result = result || this.endsWith.stream().anyMatch(candidate::endsWith);</b>
<b class="nc">&nbsp;			result = result || this.contains.stream().anyMatch(candidate::contains);</b>
<b class="nc">&nbsp;			return result;</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	public static class LibraryVersion {
&nbsp;
&nbsp;		private final DependencyVersion version;
&nbsp;
<b class="nc">&nbsp;		public LibraryVersion(DependencyVersion version) {</b>
<b class="nc">&nbsp;			this.version = version;</b>
&nbsp;		}
&nbsp;
&nbsp;		public DependencyVersion getVersion() {
<b class="nc">&nbsp;			return this.version;</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * A collection of modules, Maven plugins, and Maven boms with the same group ID.
&nbsp;	 */
&nbsp;	public static class Group {
&nbsp;
&nbsp;		private final String id;
&nbsp;
&nbsp;		private final List&lt;Module&gt; modules;
&nbsp;
&nbsp;		private final List&lt;String&gt; plugins;
&nbsp;
&nbsp;		private final List&lt;String&gt; boms;
&nbsp;
<b class="nc">&nbsp;		public Group(String id, List&lt;Module&gt; modules, List&lt;String&gt; plugins, List&lt;String&gt; boms) {</b>
<b class="nc">&nbsp;			this.id = id;</b>
<b class="nc">&nbsp;			this.modules = modules;</b>
<b class="nc">&nbsp;			this.plugins = plugins;</b>
<b class="nc">&nbsp;			this.boms = boms;</b>
&nbsp;		}
&nbsp;
&nbsp;		public String getId() {
<b class="nc">&nbsp;			return this.id;</b>
&nbsp;		}
&nbsp;
&nbsp;		public List&lt;Module&gt; getModules() {
<b class="nc">&nbsp;			return this.modules;</b>
&nbsp;		}
&nbsp;
&nbsp;		public List&lt;String&gt; getPlugins() {
<b class="nc">&nbsp;			return this.plugins;</b>
&nbsp;		}
&nbsp;
&nbsp;		public List&lt;String&gt; getBoms() {
<b class="nc">&nbsp;			return this.boms;</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * A module in a group.
&nbsp;	 */
&nbsp;	public static class Module {
&nbsp;
&nbsp;		private final String name;
&nbsp;
&nbsp;		private final String type;
&nbsp;
&nbsp;		private final String classifier;
&nbsp;
&nbsp;		private final List&lt;Exclusion&gt; exclusions;
&nbsp;
&nbsp;		public Module(String name) {
<b class="nc">&nbsp;			this(name, Collections.emptyList());</b>
&nbsp;		}
&nbsp;
&nbsp;		public Module(String name, String type) {
<b class="nc">&nbsp;			this(name, type, null, Collections.emptyList());</b>
&nbsp;		}
&nbsp;
&nbsp;		public Module(String name, List&lt;Exclusion&gt; exclusions) {
<b class="nc">&nbsp;			this(name, null, null, exclusions);</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		public Module(String name, String type, String classifier, List&lt;Exclusion&gt; exclusions) {</b>
<b class="nc">&nbsp;			this.name = name;</b>
<b class="nc">&nbsp;			this.type = type;</b>
<b class="nc">&nbsp;			this.classifier = (classifier != null) ? classifier : &quot;&quot;;</b>
<b class="nc">&nbsp;			this.exclusions = exclusions;</b>
&nbsp;		}
&nbsp;
&nbsp;		public String getName() {
<b class="nc">&nbsp;			return this.name;</b>
&nbsp;		}
&nbsp;
&nbsp;		public String getClassifier() {
<b class="nc">&nbsp;			return this.classifier;</b>
&nbsp;		}
&nbsp;
&nbsp;		public String getType() {
<b class="nc">&nbsp;			return this.type;</b>
&nbsp;		}
&nbsp;
&nbsp;		public List&lt;Exclusion&gt; getExclusions() {
<b class="nc">&nbsp;			return this.exclusions;</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * An exclusion of a dependency identified by its group ID and artifact ID.
&nbsp;	 */
&nbsp;	public static class Exclusion {
&nbsp;
&nbsp;		private final String groupId;
&nbsp;
&nbsp;		private final String artifactId;
&nbsp;
<b class="nc">&nbsp;		public Exclusion(String groupId, String artifactId) {</b>
<b class="nc">&nbsp;			this.groupId = groupId;</b>
<b class="nc">&nbsp;			this.artifactId = artifactId;</b>
&nbsp;		}
&nbsp;
&nbsp;		public String getGroupId() {
<b class="nc">&nbsp;			return this.groupId;</b>
&nbsp;		}
&nbsp;
&nbsp;		public String getArtifactId() {
<b class="nc">&nbsp;			return this.artifactId;</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Version alignment for a library.
&nbsp;	 */
&nbsp;	public static class VersionAlignment {
&nbsp;
&nbsp;		private final String from;
&nbsp;
&nbsp;		private final String managedBy;
&nbsp;
&nbsp;		private final Project project;
&nbsp;
&nbsp;		private final List&lt;Library&gt; libraries;
&nbsp;
&nbsp;		private final List&lt;Group&gt; groups;
&nbsp;
&nbsp;		private Set&lt;String&gt; alignedVersions;
&nbsp;
<b class="nc">&nbsp;		VersionAlignment(String from, String managedBy, Project project, List&lt;Library&gt; libraries, List&lt;Group&gt; groups) {</b>
<b class="nc">&nbsp;			this.from = from;</b>
<b class="nc">&nbsp;			this.managedBy = managedBy;</b>
<b class="nc">&nbsp;			this.project = project;</b>
<b class="nc">&nbsp;			this.libraries = libraries;</b>
<b class="nc">&nbsp;			this.groups = groups;</b>
&nbsp;		}
&nbsp;
&nbsp;		public Set&lt;String&gt; resolve() {
<b class="nc">&nbsp;			if (this.managedBy == null) {</b>
<b class="nc">&nbsp;				throw new IllegalStateException(&quot;Version alignment without managedBy is not supported&quot;);</b>
&nbsp;			}
<b class="nc">&nbsp;			if (this.alignedVersions != null) {</b>
<b class="nc">&nbsp;				return this.alignedVersions;</b>
&nbsp;			}
<b class="nc">&nbsp;			Library managingLibrary = this.libraries.stream()</b>
<b class="nc">&nbsp;				.filter((candidate) -&gt; this.managedBy.equals(candidate.getName()))</b>
<b class="nc">&nbsp;				.findFirst()</b>
<b class="nc">&nbsp;				.orElseThrow(() -&gt; new IllegalStateException(&quot;Managing library &#39;&quot; + this.managedBy + &quot;&#39; not found.&quot;));</b>
<b class="nc">&nbsp;			Map&lt;String, String&gt; versions = resolveAligningDependencies(managingLibrary);</b>
<b class="nc">&nbsp;			Set&lt;String&gt; versionsInLibrary = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;			for (Group group : this.groups) {</b>
<b class="nc">&nbsp;				for (Module module : group.getModules()) {</b>
<b class="nc">&nbsp;					String version = versions.get(group.getId() + &quot;:&quot; + module.getName());</b>
<b class="nc">&nbsp;					if (version != null) {</b>
<b class="nc">&nbsp;						versionsInLibrary.add(version);</b>
&nbsp;					}
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;				for (String plugin : group.getPlugins()) {</b>
<b class="nc">&nbsp;					String version = versions.get(group.getId() + &quot;:&quot; + plugin);</b>
<b class="nc">&nbsp;					if (version != null) {</b>
<b class="nc">&nbsp;						versionsInLibrary.add(version);</b>
&nbsp;					}
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			this.alignedVersions = versionsInLibrary;</b>
<b class="nc">&nbsp;			return this.alignedVersions;</b>
&nbsp;		}
&nbsp;
&nbsp;		private Map&lt;String, String&gt; resolveAligningDependencies(Library manager) {
<b class="nc">&nbsp;			DependencyHandler dependencyHandler = this.project.getDependencies();</b>
<b class="nc">&nbsp;			List&lt;Dependency&gt; boms = manager.getGroups()</b>
<b class="nc">&nbsp;				.stream()</b>
<b class="nc">&nbsp;				.flatMap((group) -&gt; group.getBoms()</b>
<b class="nc">&nbsp;					.stream()</b>
<b class="nc">&nbsp;					.map((bom) -&gt; dependencyHandler</b>
<b class="nc">&nbsp;						.platform(group.getId() + &quot;:&quot; + bom + &quot;:&quot; + manager.getVersion().getVersion())))</b>
<b class="nc">&nbsp;				.toList();</b>
<b class="nc">&nbsp;			List&lt;Dependency&gt; dependencies = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;			dependencies.addAll(boms);</b>
<b class="nc">&nbsp;			dependencies.add(dependencyHandler.create(this.from));</b>
<b class="nc">&nbsp;			Configuration alignmentConfiguration = this.project.getConfigurations()</b>
<b class="nc">&nbsp;				.detachedConfiguration(dependencies.toArray(new Dependency[0]));</b>
<b class="nc">&nbsp;			Map&lt;String, String&gt; versions = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;			for (DependencyResult dependency : alignmentConfiguration.getIncoming()</b>
<b class="nc">&nbsp;				.getResolutionResult()</b>
<b class="nc">&nbsp;				.getAllDependencies()) {</b>
<b class="nc">&nbsp;				versions.put(dependency.getFrom().getModuleVersion().getModule().toString(),</b>
<b class="nc">&nbsp;						dependency.getFrom().getModuleVersion().getVersion());</b>
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			return versions;</b>
&nbsp;		}
&nbsp;
&nbsp;		String getFrom() {
<b class="nc">&nbsp;			return this.from;</b>
&nbsp;		}
&nbsp;
&nbsp;		String getManagedBy() {
<b class="nc">&nbsp;			return this.managedBy;</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public String toString() {
<b class="nc">&nbsp;			return &quot;version from dependencies of &quot; + this.from + &quot; that is managed by &quot; + this.managedBy;</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-03-28 21:28</div>
</div>
</body>
</html>
