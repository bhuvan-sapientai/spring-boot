


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > AbstractLoggingSystem</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.springframework.boot.logging</a>
</div>

<h1>Coverage Summary for Class: AbstractLoggingSystem (org.springframework.boot.logging)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">AbstractLoggingSystem</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/17)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/45)
  </span>
</td>
</tr>
  <tr>
    <td class="name">AbstractLoggingSystem$LogLevels</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/53)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * Copyright 2012-2023 the original author or authors.
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *      https://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;
&nbsp;package org.springframework.boot.logging;
&nbsp;
&nbsp;import java.util.Comparator;
&nbsp;import java.util.EnumMap;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.LinkedHashSet;
&nbsp;import java.util.Map;
&nbsp;import java.util.Set;
&nbsp;import java.util.function.Function;
&nbsp;
&nbsp;import org.springframework.core.env.Environment;
&nbsp;import org.springframework.core.io.ClassPathResource;
&nbsp;import org.springframework.util.ClassUtils;
&nbsp;import org.springframework.util.StringUtils;
&nbsp;import org.springframework.util.SystemPropertyUtils;
&nbsp;
&nbsp;/**
&nbsp; * Abstract base class for {@link LoggingSystem} implementations.
&nbsp; *
&nbsp; * @author Phillip Webb
&nbsp; * @author Dave Syer
&nbsp; * @since 1.0.0
&nbsp; */
&nbsp;public abstract class AbstractLoggingSystem extends LoggingSystem {
&nbsp;
<b class="nc">&nbsp;	protected static final Comparator&lt;LoggerConfiguration&gt; CONFIGURATION_COMPARATOR = new LoggerConfigurationComparator(</b>
&nbsp;			ROOT_LOGGER_NAME);
&nbsp;
&nbsp;	private final ClassLoader classLoader;
&nbsp;
<b class="nc">&nbsp;	public AbstractLoggingSystem(ClassLoader classLoader) {</b>
<b class="nc">&nbsp;		this.classLoader = classLoader;</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public void beforeInitialize() {
<b class="nc">&nbsp;	}</b>
&nbsp;
&nbsp;	@Override
&nbsp;	public void initialize(LoggingInitializationContext initializationContext, String configLocation, LogFile logFile) {
<b class="nc">&nbsp;		if (StringUtils.hasLength(configLocation)) {</b>
<b class="nc">&nbsp;			initializeWithSpecificConfig(initializationContext, configLocation, logFile);</b>
&nbsp;			return;
&nbsp;		}
<b class="nc">&nbsp;		initializeWithConventions(initializationContext, logFile);</b>
&nbsp;	}
&nbsp;
&nbsp;	private void initializeWithSpecificConfig(LoggingInitializationContext initializationContext, String configLocation,
&nbsp;			LogFile logFile) {
<b class="nc">&nbsp;		configLocation = SystemPropertyUtils.resolvePlaceholders(configLocation);</b>
<b class="nc">&nbsp;		loadConfiguration(initializationContext, configLocation, logFile);</b>
&nbsp;	}
&nbsp;
&nbsp;	private void initializeWithConventions(LoggingInitializationContext initializationContext, LogFile logFile) {
<b class="nc">&nbsp;		String config = getSelfInitializationConfig();</b>
<b class="nc">&nbsp;		if (config != null &amp;&amp; logFile == null) {</b>
&nbsp;			// self initialization has occurred, reinitialize in case of property changes
<b class="nc">&nbsp;			reinitialize(initializationContext);</b>
&nbsp;			return;
&nbsp;		}
<b class="nc">&nbsp;		if (config == null) {</b>
<b class="nc">&nbsp;			config = getSpringInitializationConfig();</b>
&nbsp;		}
<b class="nc">&nbsp;		if (config != null) {</b>
<b class="nc">&nbsp;			loadConfiguration(initializationContext, config, logFile);</b>
&nbsp;			return;
&nbsp;		}
<b class="nc">&nbsp;		loadDefaults(initializationContext, logFile);</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Return any self initialization config that has been applied. By default this method
&nbsp;	 * checks {@link #getStandardConfigLocations()} and assumes that any file that exists
&nbsp;	 * will have been applied.
&nbsp;	 * @return the self initialization config or {@code null}
&nbsp;	 */
&nbsp;	protected String getSelfInitializationConfig() {
<b class="nc">&nbsp;		return findConfig(getStandardConfigLocations());</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Return any spring specific initialization config that should be applied. By default
&nbsp;	 * this method checks {@link #getSpringConfigLocations()}.
&nbsp;	 * @return the spring initialization config or {@code null}
&nbsp;	 */
&nbsp;	protected String getSpringInitializationConfig() {
<b class="nc">&nbsp;		return findConfig(getSpringConfigLocations());</b>
&nbsp;	}
&nbsp;
&nbsp;	private String findConfig(String[] locations) {
<b class="nc">&nbsp;		for (String location : locations) {</b>
<b class="nc">&nbsp;			ClassPathResource resource = new ClassPathResource(location, this.classLoader);</b>
<b class="nc">&nbsp;			if (resource.exists()) {</b>
<b class="nc">&nbsp;				return &quot;classpath:&quot; + location;</b>
&nbsp;			}
&nbsp;		}
<b class="nc">&nbsp;		return null;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Return the standard config locations for this system.
&nbsp;	 * @return the standard config locations
&nbsp;	 * @see #getSelfInitializationConfig()
&nbsp;	 */
&nbsp;	protected abstract String[] getStandardConfigLocations();
&nbsp;
&nbsp;	/**
&nbsp;	 * Return the spring config locations for this system. By default this method returns
&nbsp;	 * a set of locations based on {@link #getStandardConfigLocations()}.
&nbsp;	 * @return the spring config locations
&nbsp;	 * @see #getSpringInitializationConfig()
&nbsp;	 */
&nbsp;	protected String[] getSpringConfigLocations() {
<b class="nc">&nbsp;		String[] locations = getStandardConfigLocations();</b>
<b class="nc">&nbsp;		for (int i = 0; i &lt; locations.length; i++) {</b>
<b class="nc">&nbsp;			String extension = StringUtils.getFilenameExtension(locations[i]);</b>
<b class="nc">&nbsp;			locations[i] = locations[i].substring(0, locations[i].length() - extension.length() - 1) + &quot;-spring.&quot;</b>
&nbsp;					+ extension;
&nbsp;		}
<b class="nc">&nbsp;		return locations;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Load sensible defaults for the logging system.
&nbsp;	 * @param initializationContext the logging initialization context
&nbsp;	 * @param logFile the file to load or {@code null} if no log file is to be written
&nbsp;	 */
&nbsp;	protected abstract void loadDefaults(LoggingInitializationContext initializationContext, LogFile logFile);
&nbsp;
&nbsp;	/**
&nbsp;	 * Load a specific configuration.
&nbsp;	 * @param initializationContext the logging initialization context
&nbsp;	 * @param location the location of the configuration to load (never {@code null})
&nbsp;	 * @param logFile the file to load or {@code null} if no log file is to be written
&nbsp;	 */
&nbsp;	protected abstract void loadConfiguration(LoggingInitializationContext initializationContext, String location,
&nbsp;			LogFile logFile);
&nbsp;
&nbsp;	/**
&nbsp;	 * Reinitialize the logging system if required. Called when
&nbsp;	 * {@link #getSelfInitializationConfig()} is used and the log file hasn&#39;t changed. May
&nbsp;	 * be used to reload configuration (for example to pick up additional System
&nbsp;	 * properties).
&nbsp;	 * @param initializationContext the logging initialization context
&nbsp;	 */
&nbsp;	protected void reinitialize(LoggingInitializationContext initializationContext) {
<b class="nc">&nbsp;	}</b>
&nbsp;
&nbsp;	protected final ClassLoader getClassLoader() {
<b class="nc">&nbsp;		return this.classLoader;</b>
&nbsp;	}
&nbsp;
&nbsp;	protected final String getPackagedConfigFile(String fileName) {
<b class="nc">&nbsp;		String defaultPath = ClassUtils.getPackageName(getClass());</b>
<b class="nc">&nbsp;		defaultPath = defaultPath.replace(&#39;.&#39;, &#39;/&#39;);</b>
<b class="nc">&nbsp;		defaultPath = defaultPath + &quot;/&quot; + fileName;</b>
<b class="nc">&nbsp;		defaultPath = &quot;classpath:&quot; + defaultPath;</b>
<b class="nc">&nbsp;		return defaultPath;</b>
&nbsp;	}
&nbsp;
&nbsp;	protected final void applySystemProperties(Environment environment, LogFile logFile) {
<b class="nc">&nbsp;		new LoggingSystemProperties(environment, getDefaultValueResolver(environment), null).apply(logFile);</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Return the default value resolver to use when resolving system properties.
&nbsp;	 * @param environment the environment
&nbsp;	 * @return the default value resolver
&nbsp;	 * @since 3.2.0
&nbsp;	 */
&nbsp;	protected Function&lt;String, String&gt; getDefaultValueResolver(Environment environment) {
<b class="nc">&nbsp;		String defaultLogCorrelationPattern = getDefaultLogCorrelationPattern();</b>
<b class="nc">&nbsp;		return (name) -&gt; {</b>
<b class="nc">&nbsp;			if (StringUtils.hasLength(defaultLogCorrelationPattern)</b>
<b class="nc">&nbsp;					&amp;&amp; LoggingSystemProperty.CORRELATION_PATTERN.getApplicationPropertyName().equals(name)</b>
<b class="nc">&nbsp;					&amp;&amp; environment.getProperty(LoggingSystem.EXPECT_CORRELATION_ID_PROPERTY, Boolean.class, false)) {</b>
<b class="nc">&nbsp;				return defaultLogCorrelationPattern;</b>
&nbsp;			}
<b class="nc">&nbsp;			return null;</b>
&nbsp;		};
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Return the default log correlation pattern or {@code null} if log correlation
&nbsp;	 * patterns are not supported.
&nbsp;	 * @return the default log correlation pattern
&nbsp;	 * @since 3.2.0
&nbsp;	 */
&nbsp;	protected String getDefaultLogCorrelationPattern() {
<b class="nc">&nbsp;		return null;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Maintains a mapping between native levels and {@link LogLevel}.
&nbsp;	 *
&nbsp;	 * @param &lt;T&gt; the native level type
&nbsp;	 */
&nbsp;	protected static class LogLevels&lt;T&gt; {
&nbsp;
&nbsp;		private final Map&lt;LogLevel, T&gt; systemToNative;
&nbsp;
&nbsp;		private final Map&lt;T, LogLevel&gt; nativeToSystem;
&nbsp;
<b class="nc">&nbsp;		public LogLevels() {</b>
<b class="nc">&nbsp;			this.systemToNative = new EnumMap&lt;&gt;(LogLevel.class);</b>
<b class="nc">&nbsp;			this.nativeToSystem = new HashMap&lt;&gt;();</b>
&nbsp;		}
&nbsp;
&nbsp;		public void map(LogLevel system, T nativeLevel) {
<b class="nc">&nbsp;			this.systemToNative.putIfAbsent(system, nativeLevel);</b>
<b class="nc">&nbsp;			this.nativeToSystem.putIfAbsent(nativeLevel, system);</b>
&nbsp;		}
&nbsp;
&nbsp;		public LogLevel convertNativeToSystem(T level) {
<b class="nc">&nbsp;			return this.nativeToSystem.get(level);</b>
&nbsp;		}
&nbsp;
&nbsp;		public T convertSystemToNative(LogLevel level) {
<b class="nc">&nbsp;			return this.systemToNative.get(level);</b>
&nbsp;		}
&nbsp;
&nbsp;		public Set&lt;LogLevel&gt; getSupported() {
<b class="nc">&nbsp;			return new LinkedHashSet&lt;&gt;(this.nativeToSystem.values());</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-03-28 21:28</div>
</div>
</body>
</html>
