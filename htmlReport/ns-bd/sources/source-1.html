


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > CassandraAutoConfiguration</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.springframework.boot.autoconfigure.cassandra</a>
</div>

<h1>Coverage Summary for Class: CassandraAutoConfiguration (org.springframework.boot.autoconfigure.cassandra)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">CassandraAutoConfiguration</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/115)
  </span>
</td>
</tr>
  <tr>
    <td class="name">CassandraAutoConfiguration$CassandraDriverOptions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CassandraAutoConfiguration$PropertiesCassandraConnectionDetails</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/36)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/146)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * Copyright 2012-2024 the original author or authors.
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *      https://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;
&nbsp;package org.springframework.boot.autoconfigure.cassandra;
&nbsp;
&nbsp;import java.io.IOException;
&nbsp;import java.security.NoSuchAlgorithmException;
&nbsp;import java.time.Duration;
&nbsp;import java.util.Collections;
&nbsp;import java.util.LinkedHashMap;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;
&nbsp;import javax.net.ssl.SSLContext;
&nbsp;
&nbsp;import com.datastax.oss.driver.api.core.CqlSession;
&nbsp;import com.datastax.oss.driver.api.core.CqlSessionBuilder;
&nbsp;import com.datastax.oss.driver.api.core.config.DefaultDriverOption;
&nbsp;import com.datastax.oss.driver.api.core.config.DriverConfigLoader;
&nbsp;import com.datastax.oss.driver.api.core.config.DriverOption;
&nbsp;import com.datastax.oss.driver.api.core.config.ProgrammaticDriverConfigLoaderBuilder;
&nbsp;import com.datastax.oss.driver.api.core.ssl.ProgrammaticSslEngineFactory;
&nbsp;import com.datastax.oss.driver.internal.core.config.typesafe.DefaultDriverConfigLoader;
&nbsp;import com.datastax.oss.driver.internal.core.config.typesafe.DefaultProgrammaticDriverConfigLoaderBuilder;
&nbsp;import com.typesafe.config.Config;
&nbsp;import com.typesafe.config.ConfigFactory;
&nbsp;
&nbsp;import org.springframework.beans.factory.ObjectProvider;
&nbsp;import org.springframework.boot.autoconfigure.AutoConfiguration;
&nbsp;import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
&nbsp;import org.springframework.boot.autoconfigure.cassandra.CassandraProperties.Connection;
&nbsp;import org.springframework.boot.autoconfigure.cassandra.CassandraProperties.Controlconnection;
&nbsp;import org.springframework.boot.autoconfigure.cassandra.CassandraProperties.Request;
&nbsp;import org.springframework.boot.autoconfigure.cassandra.CassandraProperties.Ssl;
&nbsp;import org.springframework.boot.autoconfigure.cassandra.CassandraProperties.Throttler;
&nbsp;import org.springframework.boot.autoconfigure.cassandra.CassandraProperties.ThrottlerType;
&nbsp;import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
&nbsp;import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
&nbsp;import org.springframework.boot.context.properties.EnableConfigurationProperties;
&nbsp;import org.springframework.boot.context.properties.PropertyMapper;
&nbsp;import org.springframework.boot.ssl.SslBundle;
&nbsp;import org.springframework.boot.ssl.SslBundles;
&nbsp;import org.springframework.boot.ssl.SslOptions;
&nbsp;import org.springframework.context.annotation.Bean;
&nbsp;import org.springframework.context.annotation.Lazy;
&nbsp;import org.springframework.context.annotation.Scope;
&nbsp;import org.springframework.core.io.Resource;
&nbsp;import org.springframework.util.Assert;
&nbsp;import org.springframework.util.StringUtils;
&nbsp;
&nbsp;/**
&nbsp; * {@link EnableAutoConfiguration Auto-configuration} for Cassandra.
&nbsp; *
&nbsp; * @author Julien Dubois
&nbsp; * @author Phillip Webb
&nbsp; * @author Eddú Meléndez
&nbsp; * @author Stephane Nicoll
&nbsp; * @author Steffen F. Qvistgaard
&nbsp; * @author Ittay Stern
&nbsp; * @author Moritz Halbritter
&nbsp; * @author Andy Wilkinson
&nbsp; * @author Phillip Webb
&nbsp; * @author Scott Frederick
&nbsp; * @since 1.3.0
&nbsp; */
&nbsp;@AutoConfiguration
&nbsp;@ConditionalOnClass(CqlSession.class)
&nbsp;@EnableConfigurationProperties(CassandraProperties.class)
&nbsp;public class CassandraAutoConfiguration {
&nbsp;
&nbsp;	private static final Config SPRING_BOOT_DEFAULTS;
&nbsp;	static {
<b class="nc">&nbsp;		CassandraDriverOptions options = new CassandraDriverOptions();</b>
<b class="nc">&nbsp;		options.add(DefaultDriverOption.CONTACT_POINTS, Collections.singletonList(&quot;127.0.0.1:9042&quot;));</b>
<b class="nc">&nbsp;		options.add(DefaultDriverOption.PROTOCOL_COMPRESSION, &quot;none&quot;);</b>
<b class="nc">&nbsp;		options.add(DefaultDriverOption.CONTROL_CONNECTION_TIMEOUT, (int) Duration.ofSeconds(5).toMillis());</b>
<b class="nc">&nbsp;		SPRING_BOOT_DEFAULTS = options.build();</b>
&nbsp;	}
&nbsp;
&nbsp;	private final CassandraProperties properties;
&nbsp;
<b class="nc">&nbsp;	CassandraAutoConfiguration(CassandraProperties properties) {</b>
<b class="nc">&nbsp;		this.properties = properties;</b>
&nbsp;	}
&nbsp;
&nbsp;	@Bean
&nbsp;	@ConditionalOnMissingBean(CassandraConnectionDetails.class)
&nbsp;	PropertiesCassandraConnectionDetails cassandraConnectionDetails() {
<b class="nc">&nbsp;		return new PropertiesCassandraConnectionDetails(this.properties);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Bean
&nbsp;	@ConditionalOnMissingBean
&nbsp;	@Lazy
&nbsp;	public CqlSession cassandraSession(CqlSessionBuilder cqlSessionBuilder) {
<b class="nc">&nbsp;		return cqlSessionBuilder.build();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Bean
&nbsp;	@ConditionalOnMissingBean
&nbsp;	@Scope(&quot;prototype&quot;)
&nbsp;	public CqlSessionBuilder cassandraSessionBuilder(DriverConfigLoader driverConfigLoader,
&nbsp;			CassandraConnectionDetails connectionDetails,
&nbsp;			ObjectProvider&lt;CqlSessionBuilderCustomizer&gt; builderCustomizers, ObjectProvider&lt;SslBundles&gt; sslBundles) {
<b class="nc">&nbsp;		CqlSessionBuilder builder = CqlSession.builder().withConfigLoader(driverConfigLoader);</b>
<b class="nc">&nbsp;		configureAuthentication(builder, connectionDetails);</b>
<b class="nc">&nbsp;		configureSsl(builder, sslBundles.getIfAvailable());</b>
<b class="nc">&nbsp;		builder.withKeyspace(this.properties.getKeyspaceName());</b>
<b class="nc">&nbsp;		builderCustomizers.orderedStream().forEach((customizer) -&gt; customizer.customize(builder));</b>
<b class="nc">&nbsp;		return builder;</b>
&nbsp;	}
&nbsp;
&nbsp;	private void configureAuthentication(CqlSessionBuilder builder, CassandraConnectionDetails connectionDetails) {
<b class="nc">&nbsp;		String username = connectionDetails.getUsername();</b>
<b class="nc">&nbsp;		if (username != null) {</b>
<b class="nc">&nbsp;			builder.withAuthCredentials(username, connectionDetails.getPassword());</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private void configureSsl(CqlSessionBuilder builder, SslBundles sslBundles) {
<b class="nc">&nbsp;		Ssl properties = this.properties.getSsl();</b>
<b class="nc">&nbsp;		if (properties == null || !properties.isEnabled()) {</b>
&nbsp;			return;
&nbsp;		}
<b class="nc">&nbsp;		String bundleName = properties.getBundle();</b>
<b class="nc">&nbsp;		if (!StringUtils.hasLength(bundleName)) {</b>
<b class="nc">&nbsp;			configureDefaultSslContext(builder);</b>
&nbsp;		}
&nbsp;		else {
<b class="nc">&nbsp;			configureSsl(builder, sslBundles.getBundle(bundleName));</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private void configureDefaultSslContext(CqlSessionBuilder builder) {
&nbsp;		try {
<b class="nc">&nbsp;			builder.withSslContext(SSLContext.getDefault());</b>
&nbsp;		}
<b class="nc">&nbsp;		catch (NoSuchAlgorithmException ex) {</b>
<b class="nc">&nbsp;			throw new IllegalStateException(&quot;Could not setup SSL default context for Cassandra&quot;, ex);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	private void configureSsl(CqlSessionBuilder builder, SslBundle sslBundle) {
<b class="nc">&nbsp;		SslOptions options = sslBundle.getOptions();</b>
<b class="nc">&nbsp;		Assert.state(options.getEnabledProtocols() == null, &quot;SSL protocol options cannot be specified with Cassandra&quot;);</b>
<b class="nc">&nbsp;		builder</b>
<b class="nc">&nbsp;			.withSslEngineFactory(new ProgrammaticSslEngineFactory(sslBundle.createSslContext(), options.getCiphers()));</b>
&nbsp;	}
&nbsp;
&nbsp;	@Bean(destroyMethod = &quot;&quot;)
&nbsp;	@ConditionalOnMissingBean
&nbsp;	public DriverConfigLoader cassandraDriverConfigLoader(CassandraConnectionDetails connectionDetails,
&nbsp;			ObjectProvider&lt;DriverConfigLoaderBuilderCustomizer&gt; builderCustomizers) {
<b class="nc">&nbsp;		ProgrammaticDriverConfigLoaderBuilder builder = new DefaultProgrammaticDriverConfigLoaderBuilder(</b>
<b class="nc">&nbsp;				() -&gt; cassandraConfiguration(connectionDetails), DefaultDriverConfigLoader.DEFAULT_ROOT_PATH);</b>
<b class="nc">&nbsp;		builderCustomizers.orderedStream().forEach((customizer) -&gt; customizer.customize(builder));</b>
<b class="nc">&nbsp;		return builder.build();</b>
&nbsp;	}
&nbsp;
&nbsp;	private Config cassandraConfiguration(CassandraConnectionDetails connectionDetails) {
<b class="nc">&nbsp;		ConfigFactory.invalidateCaches();</b>
<b class="nc">&nbsp;		Config config = ConfigFactory.defaultOverrides();</b>
<b class="nc">&nbsp;		config = config.withFallback(mapConfig(connectionDetails));</b>
<b class="nc">&nbsp;		if (this.properties.getConfig() != null) {</b>
<b class="nc">&nbsp;			config = config.withFallback(loadConfig(this.properties.getConfig()));</b>
&nbsp;		}
<b class="nc">&nbsp;		config = config.withFallback(SPRING_BOOT_DEFAULTS);</b>
<b class="nc">&nbsp;		config = config.withFallback(ConfigFactory.defaultReferenceUnresolved());</b>
<b class="nc">&nbsp;		return config.resolve();</b>
&nbsp;	}
&nbsp;
&nbsp;	private Config loadConfig(Resource resource) {
&nbsp;		try {
<b class="nc">&nbsp;			return ConfigFactory.parseURL(resource.getURL());</b>
&nbsp;		}
<b class="nc">&nbsp;		catch (IOException ex) {</b>
<b class="nc">&nbsp;			throw new IllegalStateException(&quot;Failed to load cassandra configuration from &quot; + resource, ex);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private Config mapConfig(CassandraConnectionDetails connectionDetails) {
<b class="nc">&nbsp;		CassandraDriverOptions options = new CassandraDriverOptions();</b>
<b class="nc">&nbsp;		PropertyMapper map = PropertyMapper.get().alwaysApplyingWhenNonNull();</b>
<b class="nc">&nbsp;		map.from(this.properties.getSessionName())</b>
<b class="nc">&nbsp;			.whenHasText()</b>
<b class="nc">&nbsp;			.to((sessionName) -&gt; options.add(DefaultDriverOption.SESSION_NAME, sessionName));</b>
<b class="nc">&nbsp;		map.from(connectionDetails.getUsername())</b>
<b class="nc">&nbsp;			.to((value) -&gt; options.add(DefaultDriverOption.AUTH_PROVIDER_USER_NAME, value)</b>
<b class="nc">&nbsp;				.add(DefaultDriverOption.AUTH_PROVIDER_PASSWORD, connectionDetails.getPassword()));</b>
<b class="nc">&nbsp;		map.from(this.properties::getCompression)</b>
<b class="nc">&nbsp;			.to((compression) -&gt; options.add(DefaultDriverOption.PROTOCOL_COMPRESSION, compression));</b>
<b class="nc">&nbsp;		mapConnectionOptions(options);</b>
<b class="nc">&nbsp;		mapPoolingOptions(options);</b>
<b class="nc">&nbsp;		mapRequestOptions(options);</b>
<b class="nc">&nbsp;		mapControlConnectionOptions(options);</b>
<b class="nc">&nbsp;		map.from(mapContactPoints(connectionDetails))</b>
<b class="nc">&nbsp;			.to((contactPoints) -&gt; options.add(DefaultDriverOption.CONTACT_POINTS, contactPoints));</b>
<b class="nc">&nbsp;		map.from(connectionDetails.getLocalDatacenter())</b>
<b class="nc">&nbsp;			.whenHasText()</b>
<b class="nc">&nbsp;			.to((localDatacenter) -&gt; options.add(DefaultDriverOption.LOAD_BALANCING_LOCAL_DATACENTER, localDatacenter));</b>
<b class="nc">&nbsp;		return options.build();</b>
&nbsp;	}
&nbsp;
&nbsp;	private void mapConnectionOptions(CassandraDriverOptions options) {
<b class="nc">&nbsp;		PropertyMapper map = PropertyMapper.get().alwaysApplyingWhenNonNull();</b>
<b class="nc">&nbsp;		Connection connectionProperties = this.properties.getConnection();</b>
<b class="nc">&nbsp;		map.from(connectionProperties::getConnectTimeout)</b>
<b class="nc">&nbsp;			.asInt(Duration::toMillis)</b>
<b class="nc">&nbsp;			.to((connectTimeout) -&gt; options.add(DefaultDriverOption.CONNECTION_CONNECT_TIMEOUT, connectTimeout));</b>
<b class="nc">&nbsp;		map.from(connectionProperties::getInitQueryTimeout)</b>
<b class="nc">&nbsp;			.asInt(Duration::toMillis)</b>
<b class="nc">&nbsp;			.to((initQueryTimeout) -&gt; options.add(DefaultDriverOption.CONNECTION_INIT_QUERY_TIMEOUT, initQueryTimeout));</b>
&nbsp;	}
&nbsp;
&nbsp;	private void mapPoolingOptions(CassandraDriverOptions options) {
<b class="nc">&nbsp;		PropertyMapper map = PropertyMapper.get().alwaysApplyingWhenNonNull();</b>
<b class="nc">&nbsp;		CassandraProperties.Pool poolProperties = this.properties.getPool();</b>
<b class="nc">&nbsp;		map.from(poolProperties::getIdleTimeout)</b>
<b class="nc">&nbsp;			.asInt(Duration::toMillis)</b>
<b class="nc">&nbsp;			.to((idleTimeout) -&gt; options.add(DefaultDriverOption.HEARTBEAT_TIMEOUT, idleTimeout));</b>
<b class="nc">&nbsp;		map.from(poolProperties::getHeartbeatInterval)</b>
<b class="nc">&nbsp;			.asInt(Duration::toMillis)</b>
<b class="nc">&nbsp;			.to((heartBeatInterval) -&gt; options.add(DefaultDriverOption.HEARTBEAT_INTERVAL, heartBeatInterval));</b>
&nbsp;	}
&nbsp;
&nbsp;	private void mapRequestOptions(CassandraDriverOptions options) {
<b class="nc">&nbsp;		PropertyMapper map = PropertyMapper.get().alwaysApplyingWhenNonNull();</b>
<b class="nc">&nbsp;		Request requestProperties = this.properties.getRequest();</b>
<b class="nc">&nbsp;		map.from(requestProperties::getTimeout)</b>
<b class="nc">&nbsp;			.asInt(Duration::toMillis)</b>
<b class="nc">&nbsp;			.to(((timeout) -&gt; options.add(DefaultDriverOption.REQUEST_TIMEOUT, timeout)));</b>
<b class="nc">&nbsp;		map.from(requestProperties::getConsistency)</b>
<b class="nc">&nbsp;			.to(((consistency) -&gt; options.add(DefaultDriverOption.REQUEST_CONSISTENCY, consistency)));</b>
<b class="nc">&nbsp;		map.from(requestProperties::getSerialConsistency)</b>
<b class="nc">&nbsp;			.to((serialConsistency) -&gt; options.add(DefaultDriverOption.REQUEST_SERIAL_CONSISTENCY, serialConsistency));</b>
<b class="nc">&nbsp;		map.from(requestProperties::getPageSize)</b>
<b class="nc">&nbsp;			.to((pageSize) -&gt; options.add(DefaultDriverOption.REQUEST_PAGE_SIZE, pageSize));</b>
<b class="nc">&nbsp;		Throttler throttlerProperties = requestProperties.getThrottler();</b>
<b class="nc">&nbsp;		map.from(throttlerProperties::getType)</b>
<b class="nc">&nbsp;			.as(ThrottlerType::type)</b>
<b class="nc">&nbsp;			.to((type) -&gt; options.add(DefaultDriverOption.REQUEST_THROTTLER_CLASS, type));</b>
<b class="nc">&nbsp;		map.from(throttlerProperties::getMaxQueueSize)</b>
<b class="nc">&nbsp;			.to((maxQueueSize) -&gt; options.add(DefaultDriverOption.REQUEST_THROTTLER_MAX_QUEUE_SIZE, maxQueueSize));</b>
<b class="nc">&nbsp;		map.from(throttlerProperties::getMaxConcurrentRequests)</b>
<b class="nc">&nbsp;			.to((maxConcurrentRequests) -&gt; options.add(DefaultDriverOption.REQUEST_THROTTLER_MAX_CONCURRENT_REQUESTS,</b>
<b class="nc">&nbsp;					maxConcurrentRequests));</b>
<b class="nc">&nbsp;		map.from(throttlerProperties::getMaxRequestsPerSecond)</b>
<b class="nc">&nbsp;			.to((maxRequestsPerSecond) -&gt; options.add(DefaultDriverOption.REQUEST_THROTTLER_MAX_REQUESTS_PER_SECOND,</b>
<b class="nc">&nbsp;					maxRequestsPerSecond));</b>
<b class="nc">&nbsp;		map.from(throttlerProperties::getDrainInterval)</b>
<b class="nc">&nbsp;			.asInt(Duration::toMillis)</b>
<b class="nc">&nbsp;			.to((drainInterval) -&gt; options.add(DefaultDriverOption.REQUEST_THROTTLER_DRAIN_INTERVAL, drainInterval));</b>
&nbsp;	}
&nbsp;
&nbsp;	private void mapControlConnectionOptions(CassandraDriverOptions options) {
<b class="nc">&nbsp;		PropertyMapper map = PropertyMapper.get().alwaysApplyingWhenNonNull();</b>
<b class="nc">&nbsp;		Controlconnection controlProperties = this.properties.getControlconnection();</b>
<b class="nc">&nbsp;		map.from(controlProperties::getTimeout)</b>
<b class="nc">&nbsp;			.asInt(Duration::toMillis)</b>
<b class="nc">&nbsp;			.to((timeout) -&gt; options.add(DefaultDriverOption.CONTROL_CONNECTION_TIMEOUT, timeout));</b>
&nbsp;	}
&nbsp;
&nbsp;	private List&lt;String&gt; mapContactPoints(CassandraConnectionDetails connectionDetails) {
<b class="nc">&nbsp;		return connectionDetails.getContactPoints().stream().map((node) -&gt; node.host() + &quot;:&quot; + node.port()).toList();</b>
&nbsp;	}
&nbsp;
<b class="nc">&nbsp;	private static final class CassandraDriverOptions {</b>
&nbsp;
<b class="nc">&nbsp;		private final Map&lt;String, String&gt; options = new LinkedHashMap&lt;&gt;();</b>
&nbsp;
&nbsp;		private CassandraDriverOptions add(DriverOption option, String value) {
<b class="nc">&nbsp;			String key = createKeyFor(option);</b>
<b class="nc">&nbsp;			this.options.put(key, value);</b>
<b class="nc">&nbsp;			return this;</b>
&nbsp;		}
&nbsp;
&nbsp;		private CassandraDriverOptions add(DriverOption option, int value) {
<b class="nc">&nbsp;			return add(option, String.valueOf(value));</b>
&nbsp;		}
&nbsp;
&nbsp;		private CassandraDriverOptions add(DriverOption option, Enum&lt;?&gt; value) {
<b class="nc">&nbsp;			return add(option, value.name());</b>
&nbsp;		}
&nbsp;
&nbsp;		private CassandraDriverOptions add(DriverOption option, List&lt;String&gt; values) {
<b class="nc">&nbsp;			for (int i = 0; i &lt; values.size(); i++) {</b>
<b class="nc">&nbsp;				this.options.put(String.format(&quot;%s.%s&quot;, createKeyFor(option), i), values.get(i));</b>
&nbsp;			}
<b class="nc">&nbsp;			return this;</b>
&nbsp;		}
&nbsp;
&nbsp;		private Config build() {
<b class="nc">&nbsp;			return ConfigFactory.parseMap(this.options, &quot;Environment&quot;);</b>
&nbsp;		}
&nbsp;
&nbsp;		private static String createKeyFor(DriverOption option) {
<b class="nc">&nbsp;			return String.format(&quot;%s.%s&quot;, DefaultDriverConfigLoader.DEFAULT_ROOT_PATH, option.getPath());</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Adapts {@link CassandraProperties} to {@link CassandraConnectionDetails}.
&nbsp;	 */
&nbsp;	static final class PropertiesCassandraConnectionDetails implements CassandraConnectionDetails {
&nbsp;
&nbsp;		private final CassandraProperties properties;
&nbsp;
<b class="nc">&nbsp;		private PropertiesCassandraConnectionDetails(CassandraProperties properties) {</b>
<b class="nc">&nbsp;			this.properties = properties;</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public List&lt;Node&gt; getContactPoints() {
<b class="nc">&nbsp;			List&lt;String&gt; contactPoints = this.properties.getContactPoints();</b>
<b class="nc">&nbsp;			return (contactPoints != null) ? contactPoints.stream().map(this::asNode).toList()</b>
<b class="nc">&nbsp;					: Collections.emptyList();</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public String getUsername() {
<b class="nc">&nbsp;			return this.properties.getUsername();</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public String getPassword() {
<b class="nc">&nbsp;			return this.properties.getPassword();</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public String getLocalDatacenter() {
<b class="nc">&nbsp;			return this.properties.getLocalDatacenter();</b>
&nbsp;		}
&nbsp;
&nbsp;		private Node asNode(String contactPoint) {
<b class="nc">&nbsp;			int i = contactPoint.lastIndexOf(&#39;:&#39;);</b>
<b class="nc">&nbsp;			if (i &gt;= 0) {</b>
<b class="nc">&nbsp;				String portCandidate = contactPoint.substring(i + 1);</b>
<b class="nc">&nbsp;				Integer port = asPort(portCandidate);</b>
<b class="nc">&nbsp;				if (port != null) {</b>
<b class="nc">&nbsp;					return new Node(contactPoint.substring(0, i), port);</b>
&nbsp;				}
&nbsp;			}
<b class="nc">&nbsp;			return new Node(contactPoint, this.properties.getPort());</b>
&nbsp;		}
&nbsp;
&nbsp;		private Integer asPort(String value) {
&nbsp;			try {
<b class="nc">&nbsp;				int i = Integer.parseInt(value);</b>
<b class="nc">&nbsp;				return (i &gt; 0 &amp;&amp; i &lt; 65535) ? i : null;</b>
&nbsp;			}
<b class="nc">&nbsp;			catch (Exception ex) {</b>
<b class="nc">&nbsp;				return null;</b>
&nbsp;			}
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-01 11:12</div>
</div>
</body>
</html>
