


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > WebFluxAutoConfiguration</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.springframework.boot.autoconfigure.web.reactive</a>
</div>

<h1>Coverage Summary for Class: WebFluxAutoConfiguration (org.springframework.boot.autoconfigure.web.reactive)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">WebFluxAutoConfiguration</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
</tr>
  <tr>
    <td class="name">WebFluxAutoConfiguration$EnableWebFluxConfiguration</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">WebFluxAutoConfiguration$MaxIdleTimeInMemoryWebSessionStore</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">WebFluxAutoConfiguration$ProblemDetailsErrorHandlingConfiguration</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">WebFluxAutoConfiguration$ResourceChainCustomizerConfiguration</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">WebFluxAutoConfiguration$WebFluxConfig</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/41)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">WebFluxAutoConfiguration$WelcomePageConfiguration</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/28)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/99)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * Copyright 2012-2024 the original author or authors.
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *      https://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;
&nbsp;package org.springframework.boot.autoconfigure.web.reactive;
&nbsp;
&nbsp;import java.time.Duration;
&nbsp;
&nbsp;import org.apache.commons.logging.Log;
&nbsp;import org.apache.commons.logging.LogFactory;
&nbsp;import reactor.core.publisher.Mono;
&nbsp;
&nbsp;import org.springframework.beans.factory.ListableBeanFactory;
&nbsp;import org.springframework.beans.factory.ObjectProvider;
&nbsp;import org.springframework.boot.autoconfigure.AutoConfiguration;
&nbsp;import org.springframework.boot.autoconfigure.AutoConfigureOrder;
&nbsp;import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
&nbsp;import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
&nbsp;import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
&nbsp;import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
&nbsp;import org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;
&nbsp;import org.springframework.boot.autoconfigure.http.codec.CodecsAutoConfiguration;
&nbsp;import org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration;
&nbsp;import org.springframework.boot.autoconfigure.template.TemplateAvailabilityProviders;
&nbsp;import org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration;
&nbsp;import org.springframework.boot.autoconfigure.validation.ValidatorAdapter;
&nbsp;import org.springframework.boot.autoconfigure.web.ConditionalOnEnabledResourceChain;
&nbsp;import org.springframework.boot.autoconfigure.web.ServerProperties;
&nbsp;import org.springframework.boot.autoconfigure.web.WebProperties;
&nbsp;import org.springframework.boot.autoconfigure.web.WebProperties.Resources;
&nbsp;import org.springframework.boot.autoconfigure.web.WebResourcesRuntimeHints;
&nbsp;import org.springframework.boot.autoconfigure.web.format.DateTimeFormatters;
&nbsp;import org.springframework.boot.autoconfigure.web.format.WebConversionService;
&nbsp;import org.springframework.boot.autoconfigure.web.reactive.WebFluxProperties.Format;
&nbsp;import org.springframework.boot.context.properties.EnableConfigurationProperties;
&nbsp;import org.springframework.boot.convert.ApplicationConversionService;
&nbsp;import org.springframework.boot.web.codec.CodecCustomizer;
&nbsp;import org.springframework.boot.web.reactive.filter.OrderedHiddenHttpMethodFilter;
&nbsp;import org.springframework.context.ApplicationContext;
&nbsp;import org.springframework.context.annotation.Bean;
&nbsp;import org.springframework.context.annotation.Configuration;
&nbsp;import org.springframework.context.annotation.Import;
&nbsp;import org.springframework.context.annotation.ImportRuntimeHints;
&nbsp;import org.springframework.core.Ordered;
&nbsp;import org.springframework.core.annotation.Order;
&nbsp;import org.springframework.core.task.AsyncTaskExecutor;
&nbsp;import org.springframework.format.FormatterRegistry;
&nbsp;import org.springframework.format.support.FormattingConversionService;
&nbsp;import org.springframework.http.codec.ServerCodecConfigurer;
&nbsp;import org.springframework.util.ClassUtils;
&nbsp;import org.springframework.validation.Validator;
&nbsp;import org.springframework.web.filter.reactive.HiddenHttpMethodFilter;
&nbsp;import org.springframework.web.reactive.config.BlockingExecutionConfigurer;
&nbsp;import org.springframework.web.reactive.config.DelegatingWebFluxConfiguration;
&nbsp;import org.springframework.web.reactive.config.EnableWebFlux;
&nbsp;import org.springframework.web.reactive.config.ResourceHandlerRegistration;
&nbsp;import org.springframework.web.reactive.config.ResourceHandlerRegistry;
&nbsp;import org.springframework.web.reactive.config.ViewResolverRegistry;
&nbsp;import org.springframework.web.reactive.config.WebFluxConfigurationSupport;
&nbsp;import org.springframework.web.reactive.config.WebFluxConfigurer;
&nbsp;import org.springframework.web.reactive.function.server.RouterFunction;
&nbsp;import org.springframework.web.reactive.function.server.ServerResponse;
&nbsp;import org.springframework.web.reactive.function.server.support.RouterFunctionMapping;
&nbsp;import org.springframework.web.reactive.result.method.HandlerMethodArgumentResolver;
&nbsp;import org.springframework.web.reactive.result.method.annotation.ArgumentResolverConfigurer;
&nbsp;import org.springframework.web.reactive.result.method.annotation.RequestMappingHandlerAdapter;
&nbsp;import org.springframework.web.reactive.result.method.annotation.RequestMappingHandlerMapping;
&nbsp;import org.springframework.web.reactive.result.method.annotation.ResponseEntityExceptionHandler;
&nbsp;import org.springframework.web.reactive.result.view.ViewResolver;
&nbsp;import org.springframework.web.server.WebSession;
&nbsp;import org.springframework.web.server.adapter.WebHttpHandlerBuilder;
&nbsp;import org.springframework.web.server.i18n.AcceptHeaderLocaleContextResolver;
&nbsp;import org.springframework.web.server.i18n.FixedLocaleContextResolver;
&nbsp;import org.springframework.web.server.i18n.LocaleContextResolver;
&nbsp;import org.springframework.web.server.session.DefaultWebSessionManager;
&nbsp;import org.springframework.web.server.session.InMemoryWebSessionStore;
&nbsp;import org.springframework.web.server.session.WebSessionIdResolver;
&nbsp;import org.springframework.web.server.session.WebSessionManager;
&nbsp;
&nbsp;/**
&nbsp; * {@link EnableAutoConfiguration Auto-configuration} for {@link EnableWebFlux WebFlux}.
&nbsp; *
&nbsp; * @author Brian Clozel
&nbsp; * @author Rob Winch
&nbsp; * @author Stephane Nicoll
&nbsp; * @author Andy Wilkinson
&nbsp; * @author Phillip Webb
&nbsp; * @author Eddú Meléndez
&nbsp; * @author Artsiom Yudovin
&nbsp; * @author Chris Bono
&nbsp; * @author Weix Sun
&nbsp; * @since 2.0.0
&nbsp; */
&nbsp;@AutoConfiguration(after = { ReactiveWebServerFactoryAutoConfiguration.class, CodecsAutoConfiguration.class,
&nbsp;		ReactiveMultipartAutoConfiguration.class, ValidationAutoConfiguration.class,
&nbsp;		WebSessionIdResolverAutoConfiguration.class })
&nbsp;@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.REACTIVE)
&nbsp;@ConditionalOnClass(WebFluxConfigurer.class)
&nbsp;@ConditionalOnMissingBean({ WebFluxConfigurationSupport.class })
&nbsp;@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)
&nbsp;@ImportRuntimeHints(WebResourcesRuntimeHints.class)
<b class="nc">&nbsp;public class WebFluxAutoConfiguration {</b>
&nbsp;
&nbsp;	@Bean
&nbsp;	@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)
&nbsp;	@ConditionalOnProperty(prefix = &quot;spring.webflux.hiddenmethod.filter&quot;, name = &quot;enabled&quot;)
&nbsp;	public OrderedHiddenHttpMethodFilter hiddenHttpMethodFilter() {
<b class="nc">&nbsp;		return new OrderedHiddenHttpMethodFilter();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Configuration(proxyBeanMethods = false)
<b class="nc">&nbsp;	public static class WelcomePageConfiguration {</b>
&nbsp;
&nbsp;		@Bean
&nbsp;		public RouterFunctionMapping welcomePageRouterFunctionMapping(ApplicationContext applicationContext,
&nbsp;				WebFluxProperties webFluxProperties, WebProperties webProperties) {
<b class="nc">&nbsp;			String[] staticLocations = webProperties.getResources().getStaticLocations();</b>
<b class="nc">&nbsp;			WelcomePageRouterFunctionFactory factory = new WelcomePageRouterFunctionFactory(</b>
&nbsp;					new TemplateAvailabilityProviders(applicationContext), applicationContext, staticLocations,
<b class="nc">&nbsp;					webFluxProperties.getStaticPathPattern());</b>
<b class="nc">&nbsp;			RouterFunction&lt;ServerResponse&gt; routerFunction = factory.createRouterFunction();</b>
<b class="nc">&nbsp;			if (routerFunction != null) {</b>
<b class="nc">&nbsp;				RouterFunctionMapping routerFunctionMapping = new RouterFunctionMapping(routerFunction);</b>
<b class="nc">&nbsp;				routerFunctionMapping.setOrder(1);</b>
<b class="nc">&nbsp;				return routerFunctionMapping;</b>
&nbsp;			}
<b class="nc">&nbsp;			return null;</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Configuration(proxyBeanMethods = false)
&nbsp;	@EnableConfigurationProperties({ WebProperties.class, WebFluxProperties.class })
&nbsp;	@Import({ EnableWebFluxConfiguration.class })
&nbsp;	@Order(0)
&nbsp;	public static class WebFluxConfig implements WebFluxConfigurer {
&nbsp;
<b class="nc">&nbsp;		private static final Log logger = LogFactory.getLog(WebFluxConfig.class);</b>
&nbsp;
&nbsp;		private final Resources resourceProperties;
&nbsp;
&nbsp;		private final WebFluxProperties webFluxProperties;
&nbsp;
&nbsp;		private final ListableBeanFactory beanFactory;
&nbsp;
&nbsp;		private final ObjectProvider&lt;HandlerMethodArgumentResolver&gt; argumentResolvers;
&nbsp;
&nbsp;		private final ObjectProvider&lt;CodecCustomizer&gt; codecCustomizers;
&nbsp;
&nbsp;		private final ResourceHandlerRegistrationCustomizer resourceHandlerRegistrationCustomizer;
&nbsp;
&nbsp;		private final ObjectProvider&lt;ViewResolver&gt; viewResolvers;
&nbsp;
&nbsp;		public WebFluxConfig(WebProperties webProperties, WebFluxProperties webFluxProperties,
&nbsp;				ListableBeanFactory beanFactory, ObjectProvider&lt;HandlerMethodArgumentResolver&gt; resolvers,
&nbsp;				ObjectProvider&lt;CodecCustomizer&gt; codecCustomizers,
&nbsp;				ObjectProvider&lt;ResourceHandlerRegistrationCustomizer&gt; resourceHandlerRegistrationCustomizer,
<b class="nc">&nbsp;				ObjectProvider&lt;ViewResolver&gt; viewResolvers) {</b>
<b class="nc">&nbsp;			this.resourceProperties = webProperties.getResources();</b>
<b class="nc">&nbsp;			this.webFluxProperties = webFluxProperties;</b>
<b class="nc">&nbsp;			this.beanFactory = beanFactory;</b>
<b class="nc">&nbsp;			this.argumentResolvers = resolvers;</b>
<b class="nc">&nbsp;			this.codecCustomizers = codecCustomizers;</b>
<b class="nc">&nbsp;			this.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizer.getIfAvailable();</b>
<b class="nc">&nbsp;			this.viewResolvers = viewResolvers;</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public void configureArgumentResolvers(ArgumentResolverConfigurer configurer) {
<b class="nc">&nbsp;			this.argumentResolvers.orderedStream().forEach(configurer::addCustomResolver);</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public void configureHttpMessageCodecs(ServerCodecConfigurer configurer) {
<b class="nc">&nbsp;			this.codecCustomizers.orderedStream().forEach((customizer) -&gt; customizer.customize(configurer));</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public void configureBlockingExecution(BlockingExecutionConfigurer configurer) {
<b class="nc">&nbsp;			if (this.beanFactory.containsBean(TaskExecutionAutoConfiguration.APPLICATION_TASK_EXECUTOR_BEAN_NAME)) {</b>
<b class="nc">&nbsp;				Object taskExecutor = this.beanFactory</b>
<b class="nc">&nbsp;					.getBean(TaskExecutionAutoConfiguration.APPLICATION_TASK_EXECUTOR_BEAN_NAME);</b>
<b class="nc">&nbsp;				if (taskExecutor instanceof AsyncTaskExecutor asyncTaskExecutor) {</b>
<b class="nc">&nbsp;					configurer.setExecutor(asyncTaskExecutor);</b>
&nbsp;				}
&nbsp;			}
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public void addResourceHandlers(ResourceHandlerRegistry registry) {
<b class="nc">&nbsp;			if (!this.resourceProperties.isAddMappings()) {</b>
<b class="nc">&nbsp;				logger.debug(&quot;Default resource handling disabled&quot;);</b>
&nbsp;				return;
&nbsp;			}
<b class="nc">&nbsp;			String webjarsPathPattern = this.webFluxProperties.getWebjarsPathPattern();</b>
<b class="nc">&nbsp;			if (!registry.hasMappingForPattern(webjarsPathPattern)) {</b>
<b class="nc">&nbsp;				ResourceHandlerRegistration registration = registry.addResourceHandler(webjarsPathPattern)</b>
<b class="nc">&nbsp;					.addResourceLocations(&quot;classpath:/META-INF/resources/webjars/&quot;);</b>
<b class="nc">&nbsp;				configureResourceCaching(registration);</b>
<b class="nc">&nbsp;				customizeResourceHandlerRegistration(registration);</b>
&nbsp;			}
<b class="nc">&nbsp;			String staticPathPattern = this.webFluxProperties.getStaticPathPattern();</b>
<b class="nc">&nbsp;			if (!registry.hasMappingForPattern(staticPathPattern)) {</b>
<b class="nc">&nbsp;				ResourceHandlerRegistration registration = registry.addResourceHandler(staticPathPattern)</b>
<b class="nc">&nbsp;					.addResourceLocations(this.resourceProperties.getStaticLocations());</b>
<b class="nc">&nbsp;				configureResourceCaching(registration);</b>
<b class="nc">&nbsp;				customizeResourceHandlerRegistration(registration);</b>
&nbsp;			}
&nbsp;		}
&nbsp;
&nbsp;		private void configureResourceCaching(ResourceHandlerRegistration registration) {
<b class="nc">&nbsp;			Duration cachePeriod = this.resourceProperties.getCache().getPeriod();</b>
<b class="nc">&nbsp;			WebProperties.Resources.Cache.Cachecontrol cacheControl = this.resourceProperties.getCache()</b>
<b class="nc">&nbsp;				.getCachecontrol();</b>
<b class="nc">&nbsp;			if (cachePeriod != null &amp;&amp; cacheControl.getMaxAge() == null) {</b>
<b class="nc">&nbsp;				cacheControl.setMaxAge(cachePeriod);</b>
&nbsp;			}
<b class="nc">&nbsp;			registration.setCacheControl(cacheControl.toHttpCacheControl());</b>
<b class="nc">&nbsp;			registration.setUseLastModified(this.resourceProperties.getCache().isUseLastModified());</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public void configureViewResolvers(ViewResolverRegistry registry) {
<b class="nc">&nbsp;			this.viewResolvers.orderedStream().forEach(registry::viewResolver);</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public void addFormatters(FormatterRegistry registry) {
<b class="nc">&nbsp;			ApplicationConversionService.addBeans(registry, this.beanFactory);</b>
&nbsp;		}
&nbsp;
&nbsp;		private void customizeResourceHandlerRegistration(ResourceHandlerRegistration registration) {
<b class="nc">&nbsp;			if (this.resourceHandlerRegistrationCustomizer != null) {</b>
<b class="nc">&nbsp;				this.resourceHandlerRegistrationCustomizer.customize(registration);</b>
&nbsp;			}
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Configuration equivalent to {@code @EnableWebFlux}.
&nbsp;	 */
&nbsp;	@Configuration(proxyBeanMethods = false)
&nbsp;	@EnableConfigurationProperties({ WebProperties.class, ServerProperties.class })
&nbsp;	public static class EnableWebFluxConfiguration extends DelegatingWebFluxConfiguration {
&nbsp;
&nbsp;		private final WebFluxProperties webFluxProperties;
&nbsp;
&nbsp;		private final WebProperties webProperties;
&nbsp;
&nbsp;		private final ServerProperties serverProperties;
&nbsp;
&nbsp;		private final WebFluxRegistrations webFluxRegistrations;
&nbsp;
&nbsp;		public EnableWebFluxConfiguration(WebFluxProperties webFluxProperties, WebProperties webProperties,
<b class="nc">&nbsp;				ServerProperties serverProperties, ObjectProvider&lt;WebFluxRegistrations&gt; webFluxRegistrations) {</b>
<b class="nc">&nbsp;			this.webFluxProperties = webFluxProperties;</b>
<b class="nc">&nbsp;			this.webProperties = webProperties;</b>
<b class="nc">&nbsp;			this.serverProperties = serverProperties;</b>
<b class="nc">&nbsp;			this.webFluxRegistrations = webFluxRegistrations.getIfUnique();</b>
&nbsp;		}
&nbsp;
&nbsp;		@Bean
&nbsp;		@Override
&nbsp;		public FormattingConversionService webFluxConversionService() {
<b class="nc">&nbsp;			Format format = this.webFluxProperties.getFormat();</b>
<b class="nc">&nbsp;			WebConversionService conversionService = new WebConversionService(</b>
<b class="nc">&nbsp;					new DateTimeFormatters().dateFormat(format.getDate())</b>
<b class="nc">&nbsp;						.timeFormat(format.getTime())</b>
<b class="nc">&nbsp;						.dateTimeFormat(format.getDateTime()));</b>
<b class="nc">&nbsp;			addFormatters(conversionService);</b>
<b class="nc">&nbsp;			return conversionService;</b>
&nbsp;		}
&nbsp;
&nbsp;		@Bean
&nbsp;		@Override
&nbsp;		public Validator webFluxValidator() {
<b class="nc">&nbsp;			if (!ClassUtils.isPresent(&quot;jakarta.validation.Validator&quot;, getClass().getClassLoader())) {</b>
<b class="nc">&nbsp;				return super.webFluxValidator();</b>
&nbsp;			}
<b class="nc">&nbsp;			return ValidatorAdapter.get(getApplicationContext(), getValidator());</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		protected RequestMappingHandlerAdapter createRequestMappingHandlerAdapter() {
<b class="nc">&nbsp;			if (this.webFluxRegistrations != null) {</b>
<b class="nc">&nbsp;				RequestMappingHandlerAdapter adapter = this.webFluxRegistrations.getRequestMappingHandlerAdapter();</b>
<b class="nc">&nbsp;				if (adapter != null) {</b>
<b class="nc">&nbsp;					return adapter;</b>
&nbsp;				}
&nbsp;			}
<b class="nc">&nbsp;			return super.createRequestMappingHandlerAdapter();</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		protected RequestMappingHandlerMapping createRequestMappingHandlerMapping() {
<b class="nc">&nbsp;			if (this.webFluxRegistrations != null) {</b>
<b class="nc">&nbsp;				RequestMappingHandlerMapping mapping = this.webFluxRegistrations.getRequestMappingHandlerMapping();</b>
<b class="nc">&nbsp;				if (mapping != null) {</b>
<b class="nc">&nbsp;					return mapping;</b>
&nbsp;				}
&nbsp;			}
<b class="nc">&nbsp;			return super.createRequestMappingHandlerMapping();</b>
&nbsp;		}
&nbsp;
&nbsp;		@Bean
&nbsp;		@Override
&nbsp;		@ConditionalOnMissingBean(name = WebHttpHandlerBuilder.LOCALE_CONTEXT_RESOLVER_BEAN_NAME)
&nbsp;		public LocaleContextResolver localeContextResolver() {
<b class="nc">&nbsp;			if (this.webProperties.getLocaleResolver() == WebProperties.LocaleResolver.FIXED) {</b>
<b class="nc">&nbsp;				return new FixedLocaleContextResolver(this.webProperties.getLocale());</b>
&nbsp;			}
<b class="nc">&nbsp;			AcceptHeaderLocaleContextResolver localeContextResolver = new AcceptHeaderLocaleContextResolver();</b>
<b class="nc">&nbsp;			localeContextResolver.setDefaultLocale(this.webProperties.getLocale());</b>
<b class="nc">&nbsp;			return localeContextResolver;</b>
&nbsp;		}
&nbsp;
&nbsp;		@Bean
&nbsp;		@ConditionalOnMissingBean(name = WebHttpHandlerBuilder.WEB_SESSION_MANAGER_BEAN_NAME)
&nbsp;		public WebSessionManager webSessionManager(ObjectProvider&lt;WebSessionIdResolver&gt; webSessionIdResolver) {
<b class="nc">&nbsp;			DefaultWebSessionManager webSessionManager = new DefaultWebSessionManager();</b>
<b class="nc">&nbsp;			Duration timeout = this.serverProperties.getReactive().getSession().getTimeout();</b>
<b class="nc">&nbsp;			int maxSessions = this.serverProperties.getReactive().getSession().getMaxSessions();</b>
<b class="nc">&nbsp;			MaxIdleTimeInMemoryWebSessionStore sessionStore = new MaxIdleTimeInMemoryWebSessionStore(timeout);</b>
<b class="nc">&nbsp;			sessionStore.setMaxSessions(maxSessions);</b>
<b class="nc">&nbsp;			webSessionManager.setSessionStore(sessionStore);</b>
<b class="nc">&nbsp;			webSessionIdResolver.ifAvailable(webSessionManager::setSessionIdResolver);</b>
<b class="nc">&nbsp;			return webSessionManager;</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Configuration(proxyBeanMethods = false)
&nbsp;	@ConditionalOnEnabledResourceChain
<b class="nc">&nbsp;	static class ResourceChainCustomizerConfiguration {</b>
&nbsp;
&nbsp;		@Bean
&nbsp;		ResourceChainResourceHandlerRegistrationCustomizer resourceHandlerRegistrationCustomizer(
&nbsp;				WebProperties webProperties) {
<b class="nc">&nbsp;			return new ResourceChainResourceHandlerRegistrationCustomizer(webProperties.getResources());</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	@Configuration(proxyBeanMethods = false)
&nbsp;	@ConditionalOnProperty(prefix = &quot;spring.webflux.problemdetails&quot;, name = &quot;enabled&quot;, havingValue = &quot;true&quot;)
<b class="nc">&nbsp;	static class ProblemDetailsErrorHandlingConfiguration {</b>
&nbsp;
&nbsp;		@Bean
&nbsp;		@ConditionalOnMissingBean(ResponseEntityExceptionHandler.class)
&nbsp;		@Order(0)
&nbsp;		ProblemDetailsExceptionHandler problemDetailsExceptionHandler() {
<b class="nc">&nbsp;			return new ProblemDetailsExceptionHandler();</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	static final class MaxIdleTimeInMemoryWebSessionStore extends InMemoryWebSessionStore {
&nbsp;
&nbsp;		private final Duration timeout;
&nbsp;
<b class="nc">&nbsp;		private MaxIdleTimeInMemoryWebSessionStore(Duration timeout) {</b>
<b class="nc">&nbsp;			this.timeout = timeout;</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public Mono&lt;WebSession&gt; createWebSession() {
<b class="nc">&nbsp;			return super.createWebSession().doOnSuccess(this::setMaxIdleTime);</b>
&nbsp;		}
&nbsp;
&nbsp;		private void setMaxIdleTime(WebSession session) {
<b class="nc">&nbsp;			session.setMaxIdleTime(this.timeout);</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-01 11:12</div>
</div>
</body>
</html>
