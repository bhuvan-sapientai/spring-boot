


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > OAuth2AuthorizationServerPropertiesMapper</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.springframework.boot.autoconfigure.security.oauth2.server.servlet</a>
</div>

<h1>Coverage Summary for Class: OAuth2AuthorizationServerPropertiesMapper (org.springframework.boot.autoconfigure.security.oauth2.server.servlet)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">OAuth2AuthorizationServerPropertiesMapper</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/69)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * Copyright 2012-2023 the original author or authors.
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *      https://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;
&nbsp;package org.springframework.boot.autoconfigure.security.oauth2.server.servlet;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;
&nbsp;import org.springframework.boot.autoconfigure.security.oauth2.server.servlet.OAuth2AuthorizationServerProperties.Client;
&nbsp;import org.springframework.boot.autoconfigure.security.oauth2.server.servlet.OAuth2AuthorizationServerProperties.Registration;
&nbsp;import org.springframework.boot.context.properties.PropertyMapper;
&nbsp;import org.springframework.security.oauth2.core.AuthorizationGrantType;
&nbsp;import org.springframework.security.oauth2.core.ClientAuthenticationMethod;
&nbsp;import org.springframework.security.oauth2.jose.jws.JwsAlgorithm;
&nbsp;import org.springframework.security.oauth2.jose.jws.MacAlgorithm;
&nbsp;import org.springframework.security.oauth2.jose.jws.SignatureAlgorithm;
&nbsp;import org.springframework.security.oauth2.server.authorization.client.RegisteredClient;
&nbsp;import org.springframework.security.oauth2.server.authorization.settings.AuthorizationServerSettings;
&nbsp;import org.springframework.security.oauth2.server.authorization.settings.ClientSettings;
&nbsp;import org.springframework.security.oauth2.server.authorization.settings.OAuth2TokenFormat;
&nbsp;import org.springframework.security.oauth2.server.authorization.settings.TokenSettings;
&nbsp;
&nbsp;/**
&nbsp; * Maps {@link OAuth2AuthorizationServerProperties} to Authorization Server types.
&nbsp; *
&nbsp; * @author Steve Riesenberg
&nbsp; */
&nbsp;final class OAuth2AuthorizationServerPropertiesMapper {
&nbsp;
&nbsp;	private final OAuth2AuthorizationServerProperties properties;
&nbsp;
<b class="nc">&nbsp;	OAuth2AuthorizationServerPropertiesMapper(OAuth2AuthorizationServerProperties properties) {</b>
<b class="nc">&nbsp;		this.properties = properties;</b>
&nbsp;	}
&nbsp;
&nbsp;	AuthorizationServerSettings asAuthorizationServerSettings() {
<b class="nc">&nbsp;		PropertyMapper map = PropertyMapper.get().alwaysApplyingWhenNonNull();</b>
<b class="nc">&nbsp;		OAuth2AuthorizationServerProperties.Endpoint endpoint = this.properties.getEndpoint();</b>
<b class="nc">&nbsp;		OAuth2AuthorizationServerProperties.OidcEndpoint oidc = endpoint.getOidc();</b>
<b class="nc">&nbsp;		AuthorizationServerSettings.Builder builder = AuthorizationServerSettings.builder();</b>
<b class="nc">&nbsp;		map.from(this.properties::getIssuer).to(builder::issuer);</b>
<b class="nc">&nbsp;		map.from(endpoint::getAuthorizationUri).to(builder::authorizationEndpoint);</b>
<b class="nc">&nbsp;		map.from(endpoint::getDeviceAuthorizationUri).to(builder::deviceAuthorizationEndpoint);</b>
<b class="nc">&nbsp;		map.from(endpoint::getDeviceVerificationUri).to(builder::deviceVerificationEndpoint);</b>
<b class="nc">&nbsp;		map.from(endpoint::getTokenUri).to(builder::tokenEndpoint);</b>
<b class="nc">&nbsp;		map.from(endpoint::getJwkSetUri).to(builder::jwkSetEndpoint);</b>
<b class="nc">&nbsp;		map.from(endpoint::getTokenRevocationUri).to(builder::tokenRevocationEndpoint);</b>
<b class="nc">&nbsp;		map.from(endpoint::getTokenIntrospectionUri).to(builder::tokenIntrospectionEndpoint);</b>
<b class="nc">&nbsp;		map.from(oidc::getLogoutUri).to(builder::oidcLogoutEndpoint);</b>
<b class="nc">&nbsp;		map.from(oidc::getClientRegistrationUri).to(builder::oidcClientRegistrationEndpoint);</b>
<b class="nc">&nbsp;		map.from(oidc::getUserInfoUri).to(builder::oidcUserInfoEndpoint);</b>
<b class="nc">&nbsp;		return builder.build();</b>
&nbsp;	}
&nbsp;
&nbsp;	List&lt;RegisteredClient&gt; asRegisteredClients() {
<b class="nc">&nbsp;		List&lt;RegisteredClient&gt; registeredClients = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;		this.properties.getClient()</b>
<b class="nc">&nbsp;			.forEach((registrationId, client) -&gt; registeredClients.add(getRegisteredClient(registrationId, client)));</b>
<b class="nc">&nbsp;		return registeredClients;</b>
&nbsp;	}
&nbsp;
&nbsp;	private RegisteredClient getRegisteredClient(String registrationId, Client client) {
<b class="nc">&nbsp;		Registration registration = client.getRegistration();</b>
<b class="nc">&nbsp;		PropertyMapper map = PropertyMapper.get().alwaysApplyingWhenNonNull();</b>
<b class="nc">&nbsp;		RegisteredClient.Builder builder = RegisteredClient.withId(registrationId);</b>
<b class="nc">&nbsp;		map.from(registration::getClientId).to(builder::clientId);</b>
<b class="nc">&nbsp;		map.from(registration::getClientSecret).to(builder::clientSecret);</b>
<b class="nc">&nbsp;		map.from(registration::getClientName).to(builder::clientName);</b>
<b class="nc">&nbsp;		registration.getClientAuthenticationMethods()</b>
<b class="nc">&nbsp;			.forEach((clientAuthenticationMethod) -&gt; map.from(clientAuthenticationMethod)</b>
<b class="nc">&nbsp;				.as(ClientAuthenticationMethod::new)</b>
<b class="nc">&nbsp;				.to(builder::clientAuthenticationMethod));</b>
<b class="nc">&nbsp;		registration.getAuthorizationGrantTypes()</b>
<b class="nc">&nbsp;			.forEach((authorizationGrantType) -&gt; map.from(authorizationGrantType)</b>
<b class="nc">&nbsp;				.as(AuthorizationGrantType::new)</b>
<b class="nc">&nbsp;				.to(builder::authorizationGrantType));</b>
<b class="nc">&nbsp;		registration.getRedirectUris().forEach((redirectUri) -&gt; map.from(redirectUri).to(builder::redirectUri));</b>
<b class="nc">&nbsp;		registration.getPostLogoutRedirectUris()</b>
<b class="nc">&nbsp;			.forEach((redirectUri) -&gt; map.from(redirectUri).to(builder::postLogoutRedirectUri));</b>
<b class="nc">&nbsp;		registration.getScopes().forEach((scope) -&gt; map.from(scope).to(builder::scope));</b>
<b class="nc">&nbsp;		builder.clientSettings(getClientSettings(client, map));</b>
<b class="nc">&nbsp;		builder.tokenSettings(getTokenSettings(client, map));</b>
<b class="nc">&nbsp;		return builder.build();</b>
&nbsp;	}
&nbsp;
&nbsp;	private ClientSettings getClientSettings(Client client, PropertyMapper map) {
<b class="nc">&nbsp;		ClientSettings.Builder builder = ClientSettings.builder();</b>
<b class="nc">&nbsp;		map.from(client::isRequireProofKey).to(builder::requireProofKey);</b>
<b class="nc">&nbsp;		map.from(client::isRequireAuthorizationConsent).to(builder::requireAuthorizationConsent);</b>
<b class="nc">&nbsp;		map.from(client::getJwkSetUri).to(builder::jwkSetUrl);</b>
<b class="nc">&nbsp;		map.from(client::getTokenEndpointAuthenticationSigningAlgorithm)</b>
<b class="nc">&nbsp;			.as(this::jwsAlgorithm)</b>
<b class="nc">&nbsp;			.to(builder::tokenEndpointAuthenticationSigningAlgorithm);</b>
<b class="nc">&nbsp;		return builder.build();</b>
&nbsp;	}
&nbsp;
&nbsp;	private TokenSettings getTokenSettings(Client client, PropertyMapper map) {
<b class="nc">&nbsp;		OAuth2AuthorizationServerProperties.Token token = client.getToken();</b>
<b class="nc">&nbsp;		TokenSettings.Builder builder = TokenSettings.builder();</b>
<b class="nc">&nbsp;		map.from(token::getAuthorizationCodeTimeToLive).to(builder::authorizationCodeTimeToLive);</b>
<b class="nc">&nbsp;		map.from(token::getAccessTokenTimeToLive).to(builder::accessTokenTimeToLive);</b>
<b class="nc">&nbsp;		map.from(token::getAccessTokenFormat).as(OAuth2TokenFormat::new).to(builder::accessTokenFormat);</b>
<b class="nc">&nbsp;		map.from(token::getDeviceCodeTimeToLive).to(builder::deviceCodeTimeToLive);</b>
<b class="nc">&nbsp;		map.from(token::isReuseRefreshTokens).to(builder::reuseRefreshTokens);</b>
<b class="nc">&nbsp;		map.from(token::getRefreshTokenTimeToLive).to(builder::refreshTokenTimeToLive);</b>
<b class="nc">&nbsp;		map.from(token::getIdTokenSignatureAlgorithm)</b>
<b class="nc">&nbsp;			.as(this::signatureAlgorithm)</b>
<b class="nc">&nbsp;			.to(builder::idTokenSignatureAlgorithm);</b>
<b class="nc">&nbsp;		return builder.build();</b>
&nbsp;	}
&nbsp;
&nbsp;	private JwsAlgorithm jwsAlgorithm(String signingAlgorithm) {
<b class="nc">&nbsp;		String name = signingAlgorithm.toUpperCase();</b>
<b class="nc">&nbsp;		JwsAlgorithm jwsAlgorithm = SignatureAlgorithm.from(name);</b>
<b class="nc">&nbsp;		if (jwsAlgorithm == null) {</b>
<b class="nc">&nbsp;			jwsAlgorithm = MacAlgorithm.from(name);</b>
&nbsp;		}
<b class="nc">&nbsp;		return jwsAlgorithm;</b>
&nbsp;	}
&nbsp;
&nbsp;	private SignatureAlgorithm signatureAlgorithm(String signatureAlgorithm) {
<b class="nc">&nbsp;		return SignatureAlgorithm.from(signatureAlgorithm.toUpperCase());</b>
&nbsp;	}
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-01 11:12</div>
</div>
</body>
</html>
