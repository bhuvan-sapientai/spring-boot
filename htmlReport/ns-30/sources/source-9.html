


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > RandomValuePropertySource</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.springframework.boot.env</a>
</div>

<h1>Coverage Summary for Class: RandomValuePropertySource (org.springframework.boot.env)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">RandomValuePropertySource</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/45)
  </span>
</td>
</tr>
  <tr>
    <td class="name">RandomValuePropertySource$Range</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/17)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/61)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * Copyright 2012-2023 the original author or authors.
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *      https://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;
&nbsp;package org.springframework.boot.env;
&nbsp;
&nbsp;import java.util.HexFormat;
&nbsp;import java.util.OptionalInt;
&nbsp;import java.util.OptionalLong;
&nbsp;import java.util.Random;
&nbsp;import java.util.UUID;
&nbsp;import java.util.function.Function;
&nbsp;
&nbsp;import org.apache.commons.logging.Log;
&nbsp;import org.apache.commons.logging.LogFactory;
&nbsp;
&nbsp;import org.springframework.core.env.ConfigurableEnvironment;
&nbsp;import org.springframework.core.env.MutablePropertySources;
&nbsp;import org.springframework.core.env.PropertySource;
&nbsp;import org.springframework.core.env.StandardEnvironment;
&nbsp;import org.springframework.core.log.LogMessage;
&nbsp;import org.springframework.util.Assert;
&nbsp;import org.springframework.util.StringUtils;
&nbsp;
&nbsp;/**
&nbsp; * {@link PropertySource} that returns a random value for any property that starts with
&nbsp; * {@literal &quot;random.&quot;}. Where the &quot;unqualified property name&quot; is the portion of the
&nbsp; * requested property name beyond the &quot;random.&quot; prefix, this {@link PropertySource}
&nbsp; * returns:
&nbsp; * &lt;ul&gt;
&nbsp; * &lt;li&gt;When {@literal &quot;int&quot;}, a random {@link Integer} value, restricted by an optionally
&nbsp; * specified range.&lt;/li&gt;
&nbsp; * &lt;li&gt;When {@literal &quot;long&quot;}, a random {@link Long} value, restricted by an optionally
&nbsp; * specified range.&lt;/li&gt;
&nbsp; * &lt;li&gt;When {@literal &quot;uuid&quot;}, a random {@link UUID} value.&lt;/li&gt;
&nbsp; * &lt;li&gt;Otherwise, a {@code byte[]}.&lt;/li&gt;
&nbsp; * &lt;/ul&gt;
&nbsp; * The {@literal &quot;random.int&quot;} and {@literal &quot;random.long&quot;} properties supports a range
&nbsp; * suffix whose syntax is:
&nbsp; * &lt;p&gt;
&nbsp; * {@code OPEN value (,max) CLOSE} where the {@code OPEN,CLOSE} are any character and
&nbsp; * {@code value,max} are integers. If {@code max} is not provided, then 0 is used as the
&nbsp; * lower bound and {@code value} is the upper bound. If {@code max} is provided then
&nbsp; * {@code value} is the minimum value and {@code max} is the maximum (exclusive).
&nbsp; *
&nbsp; * @author Dave Syer
&nbsp; * @author Matt Benson
&nbsp; * @author Madhura Bhave
&nbsp; * @author Moritz Halbritter
&nbsp; * @since 1.0.0
&nbsp; */
&nbsp;public class RandomValuePropertySource extends PropertySource&lt;Random&gt; {
&nbsp;
&nbsp;	/**
&nbsp;	 * Name of the random {@link PropertySource}.
&nbsp;	 */
&nbsp;	public static final String RANDOM_PROPERTY_SOURCE_NAME = &quot;random&quot;;
&nbsp;
&nbsp;	private static final String PREFIX = &quot;random.&quot;;
&nbsp;
<b class="nc">&nbsp;	private static final Log logger = LogFactory.getLog(RandomValuePropertySource.class);</b>
&nbsp;
&nbsp;	public RandomValuePropertySource() {
<b class="nc">&nbsp;		this(RANDOM_PROPERTY_SOURCE_NAME);</b>
&nbsp;	}
&nbsp;
&nbsp;	public RandomValuePropertySource(String name) {
<b class="nc">&nbsp;		super(name, new Random());</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public Object getProperty(String name) {
<b class="nc">&nbsp;		if (!name.startsWith(PREFIX)) {</b>
<b class="nc">&nbsp;			return null;</b>
&nbsp;		}
<b class="nc">&nbsp;		logger.trace(LogMessage.format(&quot;Generating random property for &#39;%s&#39;&quot;, name));</b>
<b class="nc">&nbsp;		return getRandomValue(name.substring(PREFIX.length()));</b>
&nbsp;	}
&nbsp;
&nbsp;	private Object getRandomValue(String type) {
<b class="nc">&nbsp;		if (type.equals(&quot;int&quot;)) {</b>
<b class="nc">&nbsp;			return getSource().nextInt();</b>
&nbsp;		}
<b class="nc">&nbsp;		if (type.equals(&quot;long&quot;)) {</b>
<b class="nc">&nbsp;			return getSource().nextLong();</b>
&nbsp;		}
<b class="nc">&nbsp;		String range = getRange(type, &quot;int&quot;);</b>
<b class="nc">&nbsp;		if (range != null) {</b>
<b class="nc">&nbsp;			return getNextIntInRange(Range.of(range, Integer::parseInt));</b>
&nbsp;		}
<b class="nc">&nbsp;		range = getRange(type, &quot;long&quot;);</b>
<b class="nc">&nbsp;		if (range != null) {</b>
<b class="nc">&nbsp;			return getNextLongInRange(Range.of(range, Long::parseLong));</b>
&nbsp;		}
<b class="nc">&nbsp;		if (type.equals(&quot;uuid&quot;)) {</b>
<b class="nc">&nbsp;			return UUID.randomUUID().toString();</b>
&nbsp;		}
<b class="nc">&nbsp;		return getRandomBytes();</b>
&nbsp;	}
&nbsp;
&nbsp;	private String getRange(String type, String prefix) {
<b class="nc">&nbsp;		if (type.startsWith(prefix)) {</b>
<b class="nc">&nbsp;			int startIndex = prefix.length() + 1;</b>
<b class="nc">&nbsp;			if (type.length() &gt; startIndex) {</b>
<b class="nc">&nbsp;				return type.substring(startIndex, type.length() - 1);</b>
&nbsp;			}
&nbsp;		}
<b class="nc">&nbsp;		return null;</b>
&nbsp;	}
&nbsp;
&nbsp;	private int getNextIntInRange(Range&lt;Integer&gt; range) {
<b class="nc">&nbsp;		OptionalInt first = getSource().ints(1, range.getMin(), range.getMax()).findFirst();</b>
<b class="nc">&nbsp;		assertPresent(first.isPresent(), range);</b>
<b class="nc">&nbsp;		return first.getAsInt();</b>
&nbsp;	}
&nbsp;
&nbsp;	private long getNextLongInRange(Range&lt;Long&gt; range) {
<b class="nc">&nbsp;		OptionalLong first = getSource().longs(1, range.getMin(), range.getMax()).findFirst();</b>
<b class="nc">&nbsp;		assertPresent(first.isPresent(), range);</b>
<b class="nc">&nbsp;		return first.getAsLong();</b>
&nbsp;	}
&nbsp;
&nbsp;	private void assertPresent(boolean present, Range&lt;?&gt; range) {
<b class="nc">&nbsp;		Assert.state(present, () -&gt; &quot;Could not get random number for range &#39;&quot; + range + &quot;&#39;&quot;);</b>
&nbsp;	}
&nbsp;
&nbsp;	private Object getRandomBytes() {
<b class="nc">&nbsp;		byte[] bytes = new byte[16];</b>
<b class="nc">&nbsp;		getSource().nextBytes(bytes);</b>
<b class="nc">&nbsp;		return HexFormat.of().withLowerCase().formatHex(bytes);</b>
&nbsp;	}
&nbsp;
&nbsp;	public static void addToEnvironment(ConfigurableEnvironment environment) {
<b class="nc">&nbsp;		addToEnvironment(environment, logger);</b>
&nbsp;	}
&nbsp;
&nbsp;	static void addToEnvironment(ConfigurableEnvironment environment, Log logger) {
<b class="nc">&nbsp;		MutablePropertySources sources = environment.getPropertySources();</b>
<b class="nc">&nbsp;		PropertySource&lt;?&gt; existing = sources.get(RANDOM_PROPERTY_SOURCE_NAME);</b>
<b class="nc">&nbsp;		if (existing != null) {</b>
<b class="nc">&nbsp;			logger.trace(&quot;RandomValuePropertySource already present&quot;);</b>
&nbsp;			return;
&nbsp;		}
<b class="nc">&nbsp;		RandomValuePropertySource randomSource = new RandomValuePropertySource(RANDOM_PROPERTY_SOURCE_NAME);</b>
<b class="nc">&nbsp;		if (sources.get(StandardEnvironment.SYSTEM_ENVIRONMENT_PROPERTY_SOURCE_NAME) != null) {</b>
<b class="nc">&nbsp;			sources.addAfter(StandardEnvironment.SYSTEM_ENVIRONMENT_PROPERTY_SOURCE_NAME, randomSource);</b>
&nbsp;		}
&nbsp;		else {
<b class="nc">&nbsp;			sources.addLast(randomSource);</b>
&nbsp;		}
<b class="nc">&nbsp;		logger.trace(&quot;RandomValuePropertySource add to Environment&quot;);</b>
&nbsp;	}
&nbsp;
&nbsp;	static final class Range&lt;T extends Number&gt; {
&nbsp;
&nbsp;		private final String value;
&nbsp;
&nbsp;		private final T min;
&nbsp;
&nbsp;		private final T max;
&nbsp;
<b class="nc">&nbsp;		private Range(String value, T min, T max) {</b>
<b class="nc">&nbsp;			this.value = value;</b>
<b class="nc">&nbsp;			this.min = min;</b>
<b class="nc">&nbsp;			this.max = max;</b>
&nbsp;		}
&nbsp;
&nbsp;		T getMin() {
<b class="nc">&nbsp;			return this.min;</b>
&nbsp;		}
&nbsp;
&nbsp;		T getMax() {
<b class="nc">&nbsp;			return this.max;</b>
&nbsp;		}
&nbsp;
&nbsp;		@Override
&nbsp;		public String toString() {
<b class="nc">&nbsp;			return this.value;</b>
&nbsp;		}
&nbsp;
&nbsp;		static &lt;T extends Number &amp; Comparable&lt;T&gt;&gt; Range&lt;T&gt; of(String value, Function&lt;String, T&gt; parse) {
<b class="nc">&nbsp;			T zero = parse.apply(&quot;0&quot;);</b>
<b class="nc">&nbsp;			String[] tokens = StringUtils.commaDelimitedListToStringArray(value);</b>
<b class="nc">&nbsp;			T min = parse.apply(tokens[0]);</b>
<b class="nc">&nbsp;			if (tokens.length == 1) {</b>
<b class="nc">&nbsp;				Assert.isTrue(min.compareTo(zero) &gt; 0, &quot;Bound must be positive.&quot;);</b>
<b class="nc">&nbsp;				return new Range&lt;&gt;(value, zero, min);</b>
&nbsp;			}
<b class="nc">&nbsp;			T max = parse.apply(tokens[1]);</b>
<b class="nc">&nbsp;			Assert.isTrue(min.compareTo(max) &lt; 0, &quot;Lower bound must be less than upper bound.&quot;);</b>
<b class="nc">&nbsp;			return new Range&lt;&gt;(value, min, max);</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-03-28 21:28</div>
</div>
</body>
</html>
