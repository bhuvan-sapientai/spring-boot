


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > ContainerConnectionSource</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.springframework.boot.testcontainers.service.connection</a>
</div>

<h1>Coverage Summary for Class: ContainerConnectionSource (org.springframework.boot.testcontainers.service.connection)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ContainerConnectionSource</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/50)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * Copyright 2012-2023 the original author or authors.
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *      https://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;
&nbsp;package org.springframework.boot.testcontainers.service.connection;
&nbsp;
&nbsp;import java.util.Set;
&nbsp;import java.util.function.Supplier;
&nbsp;
&nbsp;import org.apache.commons.logging.Log;
&nbsp;import org.apache.commons.logging.LogFactory;
&nbsp;import org.testcontainers.containers.Container;
&nbsp;import org.testcontainers.utility.DockerImageName;
&nbsp;
&nbsp;import org.springframework.boot.origin.Origin;
&nbsp;import org.springframework.boot.origin.OriginProvider;
&nbsp;import org.springframework.core.annotation.MergedAnnotation;
&nbsp;import org.springframework.core.log.LogMessage;
&nbsp;import org.springframework.util.StringUtils;
&nbsp;
&nbsp;/**
&nbsp; * Passed to {@link ContainerConnectionDetailsFactory} to provide details of the
&nbsp; * {@link ServiceConnection @ServiceConnection} annotated {@link Container} that provides
&nbsp; * the service.
&nbsp; *
&nbsp; * @param &lt;C&gt; the generic container type
&nbsp; * @author Moritz Halbritter
&nbsp; * @author Andy Wilkinson
&nbsp; * @author Phillip Webb
&nbsp; * @since 3.1.0
&nbsp; * @see ContainerConnectionDetailsFactory
&nbsp; */
&nbsp;public final class ContainerConnectionSource&lt;C extends Container&lt;?&gt;&gt; implements OriginProvider {
&nbsp;
<b class="nc">&nbsp;	private static final Log logger = LogFactory.getLog(ContainerConnectionSource.class);</b>
&nbsp;
&nbsp;	private final String beanNameSuffix;
&nbsp;
&nbsp;	private final Origin origin;
&nbsp;
&nbsp;	private final Class&lt;C&gt; containerType;
&nbsp;
&nbsp;	private final String connectionName;
&nbsp;
&nbsp;	private final Set&lt;Class&lt;?&gt;&gt; connectionDetailsTypes;
&nbsp;
&nbsp;	private final Supplier&lt;C&gt; containerSupplier;
&nbsp;
&nbsp;	ContainerConnectionSource(String beanNameSuffix, Origin origin, Class&lt;C&gt; containerType, String containerImageName,
<b class="nc">&nbsp;			MergedAnnotation&lt;ServiceConnection&gt; annotation, Supplier&lt;C&gt; containerSupplier) {</b>
<b class="nc">&nbsp;		this.beanNameSuffix = beanNameSuffix;</b>
<b class="nc">&nbsp;		this.origin = origin;</b>
<b class="nc">&nbsp;		this.containerType = containerType;</b>
<b class="nc">&nbsp;		this.connectionName = getOrDeduceConnectionName(annotation.getString(&quot;name&quot;), containerImageName);</b>
<b class="nc">&nbsp;		this.connectionDetailsTypes = Set.of(annotation.getClassArray(&quot;type&quot;));</b>
<b class="nc">&nbsp;		this.containerSupplier = containerSupplier;</b>
&nbsp;	}
&nbsp;
&nbsp;	ContainerConnectionSource(String beanNameSuffix, Origin origin, Class&lt;C&gt; containerType, String containerImageName,
<b class="nc">&nbsp;			ServiceConnection annotation, Supplier&lt;C&gt; containerSupplier) {</b>
<b class="nc">&nbsp;		this.beanNameSuffix = beanNameSuffix;</b>
<b class="nc">&nbsp;		this.origin = origin;</b>
<b class="nc">&nbsp;		this.containerType = containerType;</b>
<b class="nc">&nbsp;		this.connectionName = getOrDeduceConnectionName(annotation.name(), containerImageName);</b>
<b class="nc">&nbsp;		this.connectionDetailsTypes = Set.of(annotation.type());</b>
<b class="nc">&nbsp;		this.containerSupplier = containerSupplier;</b>
&nbsp;	}
&nbsp;
&nbsp;	private static String getOrDeduceConnectionName(String connectionName, String containerImageName) {
<b class="nc">&nbsp;		if (StringUtils.hasText(connectionName)) {</b>
<b class="nc">&nbsp;			return connectionName;</b>
&nbsp;		}
<b class="nc">&nbsp;		if (StringUtils.hasText(containerImageName)) {</b>
<b class="nc">&nbsp;			DockerImageName imageName = DockerImageName.parse(containerImageName);</b>
<b class="nc">&nbsp;			imageName.assertValid();</b>
<b class="nc">&nbsp;			return imageName.getRepository();</b>
&nbsp;		}
<b class="nc">&nbsp;		return null;</b>
&nbsp;	}
&nbsp;
&nbsp;	boolean accepts(String requiredConnectionName, Class&lt;?&gt; requiredContainerType,
&nbsp;			Class&lt;?&gt; requiredConnectionDetailsType) {
<b class="nc">&nbsp;		if (StringUtils.hasText(requiredConnectionName)</b>
<b class="nc">&nbsp;				&amp;&amp; !requiredConnectionName.equalsIgnoreCase(this.connectionName)) {</b>
<b class="nc">&nbsp;			logger.trace(LogMessage</b>
<b class="nc">&nbsp;				.of(() -&gt; &quot;%s not accepted as source connection name &#39;%s&#39; does not match required connection name &#39;%s&#39;&quot;</b>
<b class="nc">&nbsp;					.formatted(this, this.connectionName, requiredConnectionName)));</b>
<b class="nc">&nbsp;			return false;</b>
&nbsp;		}
<b class="nc">&nbsp;		if (!requiredContainerType.isAssignableFrom(this.containerType)) {</b>
<b class="nc">&nbsp;			logger.trace(LogMessage.of(() -&gt; &quot;%s not accepted as source container type %s is not assignable from %s&quot;</b>
<b class="nc">&nbsp;				.formatted(this, this.containerType.getName(), requiredContainerType.getName())));</b>
<b class="nc">&nbsp;			return false;</b>
&nbsp;		}
<b class="nc">&nbsp;		if (!this.connectionDetailsTypes.isEmpty() &amp;&amp; this.connectionDetailsTypes.stream()</b>
<b class="nc">&nbsp;			.noneMatch((candidate) -&gt; candidate.isAssignableFrom(requiredConnectionDetailsType))) {</b>
<b class="nc">&nbsp;			logger.trace(LogMessage</b>
<b class="nc">&nbsp;				.of(() -&gt; &quot;%s not accepted as source connection details types %s has no element assignable from %s&quot;</b>
<b class="nc">&nbsp;					.formatted(this, this.connectionDetailsTypes.stream().map(Class::getName).toList(),</b>
<b class="nc">&nbsp;							requiredConnectionDetailsType.getName())));</b>
<b class="nc">&nbsp;			return false;</b>
&nbsp;		}
<b class="nc">&nbsp;		logger.trace(</b>
<b class="nc">&nbsp;				LogMessage.of(() -&gt; &quot;%s accepted for connection name &#39;%s&#39; container type %s, connection details type %s&quot;</b>
<b class="nc">&nbsp;					.formatted(this, requiredConnectionName, requiredContainerType.getName(),</b>
<b class="nc">&nbsp;							requiredConnectionDetailsType.getName())));</b>
<b class="nc">&nbsp;		return true;</b>
&nbsp;	}
&nbsp;
&nbsp;	String getBeanNameSuffix() {
<b class="nc">&nbsp;		return this.beanNameSuffix;</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public Origin getOrigin() {
<b class="nc">&nbsp;		return this.origin;</b>
&nbsp;	}
&nbsp;
&nbsp;	String getConnectionName() {
<b class="nc">&nbsp;		return this.connectionName;</b>
&nbsp;	}
&nbsp;
&nbsp;	Supplier&lt;C&gt; getContainerSupplier() {
<b class="nc">&nbsp;		return this.containerSupplier;</b>
&nbsp;	}
&nbsp;
&nbsp;	Set&lt;Class&lt;?&gt;&gt; getConnectionDetailsTypes() {
<b class="nc">&nbsp;		return this.connectionDetailsTypes;</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public String toString() {
<b class="nc">&nbsp;		return &quot;@ServiceConnection source for %s&quot;.formatted(this.origin);</b>
&nbsp;	}
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-01 11:12</div>
</div>
</body>
</html>
