


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > Profiles</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.springframework.boot.context.config</a>
</div>

<h1>Coverage Summary for Class: Profiles (org.springframework.boot.context.config)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Profiles</td>
<td class="coverageStat">
  <span class="percent">
    11.8%
  </span>
  <span class="absValue">
    (2/17)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    11.7%
  </span>
  <span class="absValue">
    (7/60)
  </span>
</td>
</tr>
  <tr>
    <td class="name">Profiles$Type</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    8.3%
  </span>
  <span class="absValue">
    (2/24)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    9.5%
  </span>
  <span class="absValue">
    (7/74)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * Copyright 2012-2023 the original author or authors.
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *      https://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;
&nbsp;package org.springframework.boot.context.config;
&nbsp;
&nbsp;import java.util.ArrayDeque;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.Collection;
&nbsp;import java.util.Collections;
&nbsp;import java.util.Deque;
&nbsp;import java.util.Iterator;
&nbsp;import java.util.LinkedHashSet;
&nbsp;import java.util.List;
&nbsp;import java.util.Set;
&nbsp;import java.util.function.Function;
&nbsp;
&nbsp;import org.springframework.boot.context.properties.bind.BindResult;
&nbsp;import org.springframework.boot.context.properties.bind.Bindable;
&nbsp;import org.springframework.boot.context.properties.bind.Binder;
&nbsp;import org.springframework.boot.context.properties.source.ConfigurationPropertyName;
&nbsp;import org.springframework.core.ResolvableType;
&nbsp;import org.springframework.core.env.AbstractEnvironment;
&nbsp;import org.springframework.core.env.Environment;
&nbsp;import org.springframework.core.style.ToStringCreator;
&nbsp;import org.springframework.util.CollectionUtils;
&nbsp;import org.springframework.util.LinkedMultiValueMap;
&nbsp;import org.springframework.util.MultiValueMap;
&nbsp;import org.springframework.util.StringUtils;
&nbsp;
&nbsp;/**
&nbsp; * Provides access to environment profiles that have either been set directly on the
&nbsp; * {@link Environment} or will be set based on configuration data property values.
&nbsp; *
&nbsp; * @author Phillip Webb
&nbsp; * @author Madhura Bhave
&nbsp; * @since 2.4.0
&nbsp; */
&nbsp;public class Profiles implements Iterable&lt;String&gt; {
&nbsp;
&nbsp;	/**
&nbsp;	 * Name of property to set to specify additionally included active profiles.
&nbsp;	 */
&nbsp;	public static final String INCLUDE_PROFILES_PROPERTY_NAME = &quot;spring.profiles.include&quot;;
&nbsp;
<b class="fc">&nbsp;	static final ConfigurationPropertyName INCLUDE_PROFILES = ConfigurationPropertyName</b>
<b class="fc">&nbsp;		.of(Profiles.INCLUDE_PROFILES_PROPERTY_NAME);</b>
&nbsp;
<b class="fc">&nbsp;	private static final Bindable&lt;MultiValueMap&lt;String, String&gt;&gt; STRING_STRINGS_MAP = Bindable</b>
<b class="fc">&nbsp;		.of(ResolvableType.forClassWithGenerics(MultiValueMap.class, String.class, String.class));</b>
&nbsp;
<b class="fc">&nbsp;	private static final Bindable&lt;Set&lt;String&gt;&gt; STRING_SET = Bindable.setOf(String.class);</b>
&nbsp;
&nbsp;	private final MultiValueMap&lt;String, String&gt; groups;
&nbsp;
&nbsp;	private final List&lt;String&gt; activeProfiles;
&nbsp;
&nbsp;	private final List&lt;String&gt; defaultProfiles;
&nbsp;
&nbsp;	/**
&nbsp;	 * Create a new {@link Profiles} instance based on the {@link Environment} and
&nbsp;	 * {@link Binder}.
&nbsp;	 * @param environment the source environment
&nbsp;	 * @param binder the binder for profile properties
&nbsp;	 * @param additionalProfiles any additional active profiles
&nbsp;	 */
<b class="fc">&nbsp;	Profiles(Environment environment, Binder binder, Collection&lt;String&gt; additionalProfiles) {</b>
<b class="fc">&nbsp;		this.groups = binder.bind(&quot;spring.profiles.group&quot;, STRING_STRINGS_MAP).orElseGet(LinkedMultiValueMap::new);</b>
<b class="nc">&nbsp;		this.activeProfiles = expandProfiles(getActivatedProfiles(environment, binder, additionalProfiles));</b>
<b class="nc">&nbsp;		this.defaultProfiles = expandProfiles(getDefaultProfiles(environment, binder));</b>
&nbsp;	}
&nbsp;
&nbsp;	private List&lt;String&gt; getActivatedProfiles(Environment environment, Binder binder,
&nbsp;			Collection&lt;String&gt; additionalProfiles) {
<b class="nc">&nbsp;		return asUniqueItemList(getProfiles(environment, binder, Type.ACTIVE), additionalProfiles);</b>
&nbsp;	}
&nbsp;
&nbsp;	private List&lt;String&gt; getDefaultProfiles(Environment environment, Binder binder) {
<b class="nc">&nbsp;		return asUniqueItemList(getProfiles(environment, binder, Type.DEFAULT));</b>
&nbsp;	}
&nbsp;
&nbsp;	private Collection&lt;String&gt; getProfiles(Environment environment, Binder binder, Type type) {
<b class="nc">&nbsp;		String environmentPropertyValue = environment.getProperty(type.getName());</b>
<b class="nc">&nbsp;		Set&lt;String&gt; environmentPropertyProfiles = (!StringUtils.hasLength(environmentPropertyValue))</b>
<b class="nc">&nbsp;				? Collections.emptySet()</b>
<b class="nc">&nbsp;				: StringUtils.commaDelimitedListToSet(StringUtils.trimAllWhitespace(environmentPropertyValue));</b>
<b class="nc">&nbsp;		Set&lt;String&gt; environmentProfiles = new LinkedHashSet&lt;&gt;(Arrays.asList(type.get(environment)));</b>
<b class="nc">&nbsp;		BindResult&lt;Set&lt;String&gt;&gt; boundProfiles = binder.bind(type.getName(), STRING_SET);</b>
<b class="nc">&nbsp;		if (hasProgrammaticallySetProfiles(type, environmentPropertyValue, environmentPropertyProfiles,</b>
&nbsp;				environmentProfiles)) {
<b class="nc">&nbsp;			if (!type.isMergeWithEnvironmentProfiles() || !boundProfiles.isBound()) {</b>
<b class="nc">&nbsp;				return environmentProfiles;</b>
&nbsp;			}
<b class="nc">&nbsp;			return boundProfiles.map((bound) -&gt; merge(environmentProfiles, bound)).get();</b>
&nbsp;		}
<b class="nc">&nbsp;		return boundProfiles.orElse(type.getDefaultValue());</b>
&nbsp;	}
&nbsp;
&nbsp;	private boolean hasProgrammaticallySetProfiles(Type type, String environmentPropertyValue,
&nbsp;			Set&lt;String&gt; environmentPropertyProfiles, Set&lt;String&gt; environmentProfiles) {
<b class="nc">&nbsp;		if (!StringUtils.hasLength(environmentPropertyValue)) {</b>
<b class="nc">&nbsp;			return !type.getDefaultValue().equals(environmentProfiles);</b>
&nbsp;		}
<b class="nc">&nbsp;		if (type.getDefaultValue().equals(environmentProfiles)) {</b>
<b class="nc">&nbsp;			return false;</b>
&nbsp;		}
<b class="nc">&nbsp;		return !environmentPropertyProfiles.equals(environmentProfiles);</b>
&nbsp;	}
&nbsp;
&nbsp;	private Set&lt;String&gt; merge(Set&lt;String&gt; environmentProfiles, Set&lt;String&gt; bound) {
<b class="nc">&nbsp;		Set&lt;String&gt; result = new LinkedHashSet&lt;&gt;(environmentProfiles);</b>
<b class="nc">&nbsp;		result.addAll(bound);</b>
<b class="nc">&nbsp;		return result;</b>
&nbsp;	}
&nbsp;
&nbsp;	private List&lt;String&gt; expandProfiles(List&lt;String&gt; profiles) {
<b class="nc">&nbsp;		Deque&lt;String&gt; stack = new ArrayDeque&lt;&gt;();</b>
<b class="nc">&nbsp;		asReversedList(profiles).forEach(stack::push);</b>
<b class="nc">&nbsp;		Set&lt;String&gt; expandedProfiles = new LinkedHashSet&lt;&gt;();</b>
<b class="nc">&nbsp;		while (!stack.isEmpty()) {</b>
<b class="nc">&nbsp;			String current = stack.pop();</b>
<b class="nc">&nbsp;			if (expandedProfiles.add(current)) {</b>
<b class="nc">&nbsp;				asReversedList(this.groups.get(current)).forEach(stack::push);</b>
&nbsp;			}
<b class="nc">&nbsp;		}</b>
<b class="nc">&nbsp;		return asUniqueItemList(expandedProfiles);</b>
&nbsp;	}
&nbsp;
&nbsp;	private List&lt;String&gt; asReversedList(List&lt;String&gt; list) {
<b class="nc">&nbsp;		if (CollectionUtils.isEmpty(list)) {</b>
<b class="nc">&nbsp;			return Collections.emptyList();</b>
&nbsp;		}
<b class="nc">&nbsp;		List&lt;String&gt; reversed = new ArrayList&lt;&gt;(list);</b>
<b class="nc">&nbsp;		Collections.reverse(reversed);</b>
<b class="nc">&nbsp;		return reversed;</b>
&nbsp;	}
&nbsp;
&nbsp;	private List&lt;String&gt; asUniqueItemList(Collection&lt;String&gt; profiles) {
<b class="nc">&nbsp;		return asUniqueItemList(profiles, null);</b>
&nbsp;	}
&nbsp;
&nbsp;	private List&lt;String&gt; asUniqueItemList(Collection&lt;String&gt; profiles, Collection&lt;String&gt; additional) {
<b class="nc">&nbsp;		LinkedHashSet&lt;String&gt; uniqueItems = new LinkedHashSet&lt;&gt;();</b>
<b class="nc">&nbsp;		if (!CollectionUtils.isEmpty(additional)) {</b>
<b class="nc">&nbsp;			uniqueItems.addAll(additional);</b>
&nbsp;		}
<b class="nc">&nbsp;		uniqueItems.addAll(profiles);</b>
<b class="nc">&nbsp;		return Collections.unmodifiableList(new ArrayList&lt;&gt;(uniqueItems));</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Return an iterator for all {@link #getAccepted() accepted profiles}.
&nbsp;	 */
&nbsp;	@Override
&nbsp;	public Iterator&lt;String&gt; iterator() {
<b class="nc">&nbsp;		return getAccepted().iterator();</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Return the active profiles.
&nbsp;	 * @return the active profiles
&nbsp;	 */
&nbsp;	public List&lt;String&gt; getActive() {
<b class="nc">&nbsp;		return this.activeProfiles;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Return the default profiles.
&nbsp;	 * @return the active profiles
&nbsp;	 */
&nbsp;	public List&lt;String&gt; getDefault() {
<b class="nc">&nbsp;		return this.defaultProfiles;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Return the accepted profiles.
&nbsp;	 * @return the accepted profiles
&nbsp;	 */
&nbsp;	public List&lt;String&gt; getAccepted() {
<b class="nc">&nbsp;		return (!this.activeProfiles.isEmpty()) ? this.activeProfiles : this.defaultProfiles;</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * Return if the given profile is active.
&nbsp;	 * @param profile the profile to test
&nbsp;	 * @return if the profile is active
&nbsp;	 */
&nbsp;	public boolean isAccepted(String profile) {
<b class="nc">&nbsp;		return getAccepted().contains(profile);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public String toString() {
<b class="nc">&nbsp;		ToStringCreator creator = new ToStringCreator(this);</b>
<b class="nc">&nbsp;		creator.append(&quot;active&quot;, getActive().toString());</b>
<b class="nc">&nbsp;		creator.append(&quot;default&quot;, getDefault().toString());</b>
<b class="nc">&nbsp;		creator.append(&quot;accepted&quot;, getAccepted().toString());</b>
<b class="nc">&nbsp;		return creator.toString();</b>
&nbsp;	}
&nbsp;
&nbsp;	/**
&nbsp;	 * A profiles type that can be obtained.
&nbsp;	 */
<b class="nc">&nbsp;	private enum Type {</b>
&nbsp;
<b class="nc">&nbsp;		ACTIVE(AbstractEnvironment.ACTIVE_PROFILES_PROPERTY_NAME, Environment::getActiveProfiles, true,</b>
<b class="nc">&nbsp;				Collections.emptySet()),</b>
&nbsp;
<b class="nc">&nbsp;		DEFAULT(AbstractEnvironment.DEFAULT_PROFILES_PROPERTY_NAME, Environment::getDefaultProfiles, false,</b>
<b class="nc">&nbsp;				Collections.singleton(&quot;default&quot;));</b>
&nbsp;
&nbsp;		private final Function&lt;Environment, String[]&gt; getter;
&nbsp;
&nbsp;		private final boolean mergeWithEnvironmentProfiles;
&nbsp;
&nbsp;		private final String name;
&nbsp;
&nbsp;		private final Set&lt;String&gt; defaultValue;
&nbsp;
&nbsp;		Type(String name, Function&lt;Environment, String[]&gt; getter, boolean mergeWithEnvironmentProfiles,
<b class="nc">&nbsp;				Set&lt;String&gt; defaultValue) {</b>
<b class="nc">&nbsp;			this.name = name;</b>
<b class="nc">&nbsp;			this.getter = getter;</b>
<b class="nc">&nbsp;			this.mergeWithEnvironmentProfiles = mergeWithEnvironmentProfiles;</b>
<b class="nc">&nbsp;			this.defaultValue = defaultValue;</b>
&nbsp;		}
&nbsp;
&nbsp;		String getName() {
<b class="nc">&nbsp;			return this.name;</b>
&nbsp;		}
&nbsp;
&nbsp;		String[] get(Environment environment) {
<b class="nc">&nbsp;			return this.getter.apply(environment);</b>
&nbsp;		}
&nbsp;
&nbsp;		Set&lt;String&gt; getDefaultValue() {
<b class="nc">&nbsp;			return this.defaultValue;</b>
&nbsp;		}
&nbsp;
&nbsp;		boolean isMergeWithEnvironmentProfiles() {
<b class="nc">&nbsp;			return this.mergeWithEnvironmentProfiles;</b>
&nbsp;		}
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-01 11:12</div>
</div>
</body>
</html>
