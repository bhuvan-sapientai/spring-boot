


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > BuildImageTests</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.springframework.boot.maven</a>
</div>

<h1>Coverage Summary for Class: BuildImageTests (org.springframework.boot.maven)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">BuildImageTests</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/62)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/354)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * Copyright 2012-2023 the original author or authors.
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *      https://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;
&nbsp;package org.springframework.boot.maven;
&nbsp;
&nbsp;import java.io.File;
&nbsp;import java.io.IOException;
&nbsp;import java.nio.file.Files;
&nbsp;import java.nio.file.Path;
&nbsp;import java.nio.file.Paths;
&nbsp;import java.time.OffsetDateTime;
&nbsp;import java.util.Random;
&nbsp;import java.util.stream.IntStream;
&nbsp;
&nbsp;import org.junit.jupiter.api.TestTemplate;
&nbsp;import org.junit.jupiter.api.condition.EnabledOnOs;
&nbsp;import org.junit.jupiter.api.condition.OS;
&nbsp;import org.junit.jupiter.api.extension.ExtendWith;
&nbsp;
&nbsp;import org.springframework.boot.buildpack.platform.docker.DockerApi;
&nbsp;import org.springframework.boot.buildpack.platform.docker.DockerApi.VolumeApi;
&nbsp;import org.springframework.boot.buildpack.platform.docker.type.Image;
&nbsp;import org.springframework.boot.buildpack.platform.docker.type.ImageName;
&nbsp;import org.springframework.boot.buildpack.platform.docker.type.ImageReference;
&nbsp;import org.springframework.boot.buildpack.platform.docker.type.VolumeName;
&nbsp;import org.springframework.boot.testsupport.junit.DisabledOnOs;
&nbsp;import org.springframework.boot.testsupport.testcontainers.DisabledIfDockerUnavailable;
&nbsp;import org.springframework.util.FileSystemUtils;
&nbsp;
&nbsp;import static org.assertj.core.api.Assertions.assertThat;
&nbsp;
&nbsp;/**
&nbsp; * Integration tests for the Maven plugin&#39;s image support.
&nbsp; *
&nbsp; * @author Stephane Nicoll
&nbsp; * @author Scott Frederick
&nbsp; * @author Rafael Ceccone
&nbsp; */
&nbsp;@ExtendWith(MavenBuildExtension.class)
&nbsp;@DisabledIfDockerUnavailable
&nbsp;@DisabledOnOs(os = { OS.LINUX, OS.MAC }, architecture = &quot;aarch64&quot;,
&nbsp;		disabledReason = &quot;The builder image has no ARM support&quot;)
<b class="nc">&nbsp;class BuildImageTests extends AbstractArchiveIntegrationTests {</b>
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithoutRepackageTheArchiveIsRepackagedOnTheFly(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.prepare(this::writeLongNameResource)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				File jar = new File(project, &quot;target/build-image-0.0.1.BUILD-SNAPSHOT.jar&quot;);</b>
<b class="nc">&nbsp;				assertThat(jar).isFile();</b>
<b class="nc">&nbsp;				File original = new File(project, &quot;target/build-image-0.0.1.BUILD-SNAPSHOT.jar.original&quot;);</b>
<b class="nc">&nbsp;				assertThat(original).doesNotExist();</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack done&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedOnTheCommandLineWithoutRepackageTheArchiveIsRepackagedOnTheFly(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-cmd-line&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;spring-boot:build-image&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.prepare(this::writeLongNameResource)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				File jar = new File(project, &quot;target/build-image-cmd-line-0.0.1.BUILD-SNAPSHOT.jar&quot;);</b>
<b class="nc">&nbsp;				assertThat(jar).isFile();</b>
<b class="nc">&nbsp;				File original = new File(project, &quot;target/build-image-cmd-line-0.0.1.BUILD-SNAPSHOT.jar.original&quot;);</b>
<b class="nc">&nbsp;				assertThat(original).doesNotExist();</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-cmd-line:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack done&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-cmd-line&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithClassifierWithoutRepackageTheArchiveIsRepackagedOnTheFly(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-classifier&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.prepare(this::writeLongNameResource)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				File jar = new File(project, &quot;target/build-image-classifier-0.0.1.BUILD-SNAPSHOT.jar&quot;);</b>
<b class="nc">&nbsp;				assertThat(jar).isFile();</b>
<b class="nc">&nbsp;				File classifier = new File(project, &quot;target/build-image-classifier-0.0.1.BUILD-SNAPSHOT-test.jar&quot;);</b>
<b class="nc">&nbsp;				assertThat(classifier).doesNotExist();</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-classifier:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack done&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-classifier&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithClassifierSourceWithoutRepackageTheArchiveIsRepackagedOnTheFly(
&nbsp;			MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-classifier-source&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.prepare(this::writeLongNameResource)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				File jar = new File(project, &quot;target/build-image-classifier-source-0.0.1.BUILD-SNAPSHOT-test.jar&quot;);</b>
<b class="nc">&nbsp;				assertThat(jar).isFile();</b>
<b class="nc">&nbsp;				File original = new File(project,</b>
&nbsp;						&quot;target/build-image-classifier-source-0.0.1.BUILD-SNAPSHOT-test.jar.original&quot;);
<b class="nc">&nbsp;				assertThat(original).doesNotExist();</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-classifier-source:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack done&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-classifier-source&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithRepackageTheExistingArchiveIsUsed(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-with-repackage&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.prepare(this::writeLongNameResource)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				File jar = new File(project, &quot;target/build-image-with-repackage-0.0.1.BUILD-SNAPSHOT.jar&quot;);</b>
<b class="nc">&nbsp;				assertThat(jar).isFile();</b>
<b class="nc">&nbsp;				File original = new File(project,</b>
&nbsp;						&quot;target/build-image-with-repackage-0.0.1.BUILD-SNAPSHOT.jar.original&quot;);
<b class="nc">&nbsp;				assertThat(original).isFile();</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-with-repackage:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack done&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-with-repackage&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithClassifierAndRepackageTheExistingArchiveIsUsed(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-classifier-with-repackage&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.prepare(this::writeLongNameResource)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				File jar = new File(project, &quot;target/build-image-classifier-with-repackage-0.0.1.BUILD-SNAPSHOT.jar&quot;);</b>
<b class="nc">&nbsp;				assertThat(jar).isFile();</b>
<b class="nc">&nbsp;				File original = new File(project,</b>
&nbsp;						&quot;target/build-image-classifier-with-repackage-0.0.1.BUILD-SNAPSHOT-test.jar&quot;);
<b class="nc">&nbsp;				assertThat(original).isFile();</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-classifier-with-repackage:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack done&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-classifier-with-repackage&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithClassifierSourceAndRepackageTheExistingArchiveIsUsed(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-classifier-source-with-repackage&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.prepare(this::writeLongNameResource)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				File jar = new File(project,</b>
&nbsp;						&quot;target/build-image-classifier-source-with-repackage-0.0.1.BUILD-SNAPSHOT-test.jar&quot;);
<b class="nc">&nbsp;				assertThat(jar).isFile();</b>
<b class="nc">&nbsp;				File original = new File(project,</b>
&nbsp;						&quot;target/build-image-classifier-source-with-repackage-0.0.1.BUILD-SNAPSHOT-test.jar.original&quot;);
<b class="nc">&nbsp;				assertThat(original).isFile();</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-classifier-source-with-repackage:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack done&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-classifier-source-with-repackage&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithWarPackaging(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-war-packaging&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.prepare(this::writeLongNameResource)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				File war = new File(project, &quot;target/build-image-war-packaging-0.0.1.BUILD-SNAPSHOT.war&quot;);</b>
<b class="nc">&nbsp;				assertThat(war).isFile();</b>
<b class="nc">&nbsp;				File original = new File(project, &quot;target/build-image-war-packaging-0.0.1.BUILD-SNAPSHOT.war.original&quot;);</b>
<b class="nc">&nbsp;				assertThat(original).doesNotExist();</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-war-packaging:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack done&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-war-packaging&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithCustomImageName(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-custom-name&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.imageName&quot;, &quot;example.com/test/property-ignored:pom-preferred&quot;)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				File jar = new File(project, &quot;target/build-image-custom-name-0.0.1.BUILD-SNAPSHOT.jar&quot;);</b>
<b class="nc">&nbsp;				assertThat(jar).isFile();</b>
<b class="nc">&nbsp;				File original = new File(project, &quot;target/build-image-custom-name-0.0.1.BUILD-SNAPSHOT.jar.original&quot;);</b>
<b class="nc">&nbsp;				assertThat(original).doesNotExist();</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;example.com/test/build-image:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack done&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;example.com/test/build-image&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithCommandLineParameters(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.imageName&quot;, &quot;example.com/test/cmd-property-name:v1&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.builder&quot;,</b>
&nbsp;					&quot;projects.registry.vmware.com/springboot/spring-boot-cnb-builder:0.0.2&quot;)
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.runImage&quot;, &quot;projects.registry.vmware.com/springboot/run:tiny-cnb&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.createdDate&quot;, &quot;2020-07-01T12:34:56Z&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.applicationDirectory&quot;, &quot;/application&quot;)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;example.com/test/cmd-property-name:v1&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack done&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				Image image = new DockerApi().image()</b>
<b class="nc">&nbsp;					.inspect(ImageReference.of(&quot;example.com/test/cmd-property-name:v1&quot;));</b>
<b class="nc">&nbsp;				assertThat(image.getCreated()).isEqualTo(&quot;2020-07-01T12:34:56Z&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;example.com/test/cmd-property-name&quot;, &quot;v1&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithCustomBuilderImageAndRunImage(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-custom-builder&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-v2-builder:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack done&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;docker.io/library/build-image-v2-builder&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithEmptyEnvEntry(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-empty-env-entry&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.prepare(this::writeLongNameResource)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-empty-env-entry:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;---&gt; Test Info buildpack done&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-empty-env-entry&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithZipPackaging(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-zip-packaging&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.prepare(this::writeLongNameResource)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				File jar = new File(project, &quot;target/build-image-zip-packaging-0.0.1.BUILD-SNAPSHOT.jar&quot;);</b>
<b class="nc">&nbsp;				assertThat(jar).isFile();</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-zip-packaging:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Main-Class: org.springframework.boot.loader.launch.PropertiesLauncher&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-zip-packaging&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithBuildpacks(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-custom-buildpacks&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-custom-buildpacks:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-custom-buildpacks&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithBinding(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-bindings&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-bindings:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;binding: ca-certificates/type=ca-certificates&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;binding: ca-certificates/test.crt=---certificate one---&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-bindings&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithNetworkModeNone(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-network&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-network:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Network status: curl failed&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-network&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedOnMultiModuleProjectWithPackageGoal(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-multi-module&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-multi-module-app:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-multi-module-app&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithTags(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-tags&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-tags:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-tags:latest&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully created image tag&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-tags&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-tags&quot;, &quot;latest&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithVolumeCaches(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		String testBuildId = randomString();</b>
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-volume-caches&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;test-build-id&quot;, testBuildId)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-volume-caches:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-volume-caches&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
<b class="nc">&nbsp;				deleteVolumes(&quot;cache-&quot; + testBuildId + &quot;.build&quot;, &quot;cache-&quot; + testBuildId + &quot;.launch&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	@EnabledOnOs(value = OS.LINUX, disabledReason = &quot;Works with Docker Engine on Linux but is not reliable with &quot;
&nbsp;			+ &quot;Docker Desktop on other OSs&quot;)
&nbsp;	void whenBuildImageIsInvokedWithBindCaches(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		String testBuildId = randomString();</b>
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-bind-caches&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;test-build-id&quot;, testBuildId)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-bind-caches:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-bind-caches&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
<b class="nc">&nbsp;				String tempDir = System.getProperty(&quot;java.io.tmpdir&quot;);</b>
<b class="nc">&nbsp;				Path buildCachePath = Paths.get(tempDir, &quot;junit-image-cache-&quot; + testBuildId + &quot;-build&quot;);</b>
<b class="nc">&nbsp;				Path launchCachePath = Paths.get(tempDir, &quot;junit-image-cache-&quot; + testBuildId + &quot;-launch&quot;);</b>
<b class="nc">&nbsp;				assertThat(buildCachePath).exists().isDirectory();</b>
<b class="nc">&nbsp;				assertThat(launchCachePath).exists().isDirectory();</b>
<b class="nc">&nbsp;				FileSystemUtils.deleteRecursively(buildCachePath);</b>
<b class="nc">&nbsp;				FileSystemUtils.deleteRecursively(launchCachePath);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithCreatedDate(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		String testBuildId = randomString();</b>
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-created-date&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;test-build-id&quot;, testBuildId)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-created-date:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				Image image = new DockerApi().image()</b>
<b class="nc">&nbsp;					.inspect(ImageReference.of(&quot;docker.io/library/build-image-created-date:0.0.1.BUILD-SNAPSHOT&quot;));</b>
<b class="nc">&nbsp;				assertThat(image.getCreated()).isEqualTo(&quot;2020-07-01T12:34:56Z&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-created-date&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithCurrentCreatedDate(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		String testBuildId = randomString();</b>
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-current-created-date&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;test-build-id&quot;, testBuildId)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-current-created-date:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				Image image = new DockerApi().image()</b>
<b class="nc">&nbsp;					.inspect(ImageReference</b>
<b class="nc">&nbsp;						.of(&quot;docker.io/library/build-image-current-created-date:0.0.1.BUILD-SNAPSHOT&quot;));</b>
<b class="nc">&nbsp;				OffsetDateTime createdDateTime = OffsetDateTime.parse(image.getCreated());</b>
<b class="nc">&nbsp;				OffsetDateTime current = OffsetDateTime.now().withOffsetSameInstant(createdDateTime.getOffset());</b>
<b class="nc">&nbsp;				assertThat(createdDateTime.getYear()).isEqualTo(current.getYear());</b>
<b class="nc">&nbsp;				assertThat(createdDateTime.getMonth()).isEqualTo(current.getMonth());</b>
<b class="nc">&nbsp;				assertThat(createdDateTime.getDayOfMonth()).isEqualTo(current.getDayOfMonth());</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-current-created-date&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithApplicationDirectory(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		String testBuildId = randomString();</b>
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-app-dir&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;test-build-id&quot;, testBuildId)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-app-dir:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-app-dir&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void whenBuildImageIsInvokedWithEmptySecurityOptions(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		String testBuildId = randomString();</b>
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-security-opts&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;test-build-id&quot;, testBuildId)</b>
<b class="nc">&nbsp;			.execute((project) -&gt; {</b>
<b class="nc">&nbsp;				assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;docker.io/library/build-image-security-opts:0.0.1.BUILD-SNAPSHOT&quot;)</b>
<b class="nc">&nbsp;					.contains(&quot;Successfully built image&quot;);</b>
<b class="nc">&nbsp;				removeImage(&quot;build-image-security-opts&quot;, &quot;0.0.1.BUILD-SNAPSHOT&quot;);</b>
&nbsp;			});
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void failsWhenBuildImageIsInvokedOnMultiModuleProjectWithBuildImageGoal(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-multi-module&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;spring-boot:build-image&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.executeAndFail((project) -&gt; assertThat(buildLog(project)).contains(&quot;Error packaging archive for image&quot;));</b>
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void failsWhenBuilderFails(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-builder-error&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.executeAndFail((project) -&gt; assertThat(buildLog(project)).contains(&quot;Building image&quot;)</b>
<b class="nc">&nbsp;				.contains(&quot;---&gt; Test Info buildpack building&quot;)</b>
<b class="nc">&nbsp;				.contains(&quot;Forced builder failure&quot;)</b>
<b class="nc">&nbsp;				.containsPattern(&quot;Builder lifecycle &#39;.*&#39; failed with status code&quot;));</b>
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void failsWithBuildpackNotInBuilder(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-bad-buildpack&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.systemProperty(&quot;spring-boot.build-image.pullPolicy&quot;, &quot;IF_NOT_PRESENT&quot;)</b>
<b class="nc">&nbsp;			.executeAndFail((project) -&gt; assertThat(buildLog(project))</b>
<b class="nc">&nbsp;				.contains(&quot;&#39;urn:cnb:builder:example/does-not-exist:0.0.1&#39; not found in builder&quot;));</b>
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void failsWhenFinalNameIsMisconfigured(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-final-name&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.executeAndFail((project) -&gt; assertThat(buildLog(project)).contains(&quot;final-name.jar.original&quot;)</b>
<b class="nc">&nbsp;				.contains(&quot;is required for building an image&quot;));</b>
&nbsp;	}
&nbsp;
&nbsp;	@TestTemplate
&nbsp;	void failsWhenCachesAreConfiguredTwice(MavenBuild mavenBuild) {
<b class="nc">&nbsp;		mavenBuild.project(&quot;build-image-caches-multiple&quot;)</b>
<b class="nc">&nbsp;			.goals(&quot;package&quot;)</b>
<b class="nc">&nbsp;			.executeAndFail((project) -&gt; assertThat(buildLog(project))</b>
<b class="nc">&nbsp;				.contains(&quot;Each image building cache can be configured only once&quot;));</b>
&nbsp;	}
&nbsp;
&nbsp;	private void writeLongNameResource(File project) {
<b class="nc">&nbsp;		StringBuilder name = new StringBuilder();</b>
<b class="nc">&nbsp;		new Random().ints(&#39;a&#39;, &#39;z&#39; + 1).limit(128).forEach((i) -&gt; name.append((char) i));</b>
&nbsp;		try {
<b class="nc">&nbsp;			Path path = project.toPath().resolve(Paths.get(&quot;src&quot;, &quot;main&quot;, &quot;resources&quot;, name.toString()));</b>
<b class="nc">&nbsp;			Files.createDirectories(path.getParent());</b>
<b class="nc">&nbsp;			Files.createFile(path);</b>
&nbsp;		}
<b class="nc">&nbsp;		catch (IOException ex) {</b>
<b class="nc">&nbsp;			throw new RuntimeException(ex);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	private void removeImage(String name, String version) {
<b class="nc">&nbsp;		ImageReference imageReference = ImageReference.of(ImageName.of(name), version);</b>
&nbsp;		try {
<b class="nc">&nbsp;			new DockerApi().image().remove(imageReference, false);</b>
&nbsp;		}
<b class="nc">&nbsp;		catch (IOException ex) {</b>
<b class="nc">&nbsp;			throw new IllegalStateException(&quot;Failed to remove docker image &quot; + imageReference, ex);</b>
<b class="nc">&nbsp;		}</b>
&nbsp;	}
&nbsp;
&nbsp;	private void deleteVolumes(String... names) throws IOException {
<b class="nc">&nbsp;		VolumeApi volumeApi = new DockerApi().volume();</b>
<b class="nc">&nbsp;		for (String name : names) {</b>
<b class="nc">&nbsp;			volumeApi.delete(VolumeName.of(name), false);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	private String randomString() {
<b class="nc">&nbsp;		IntStream chars = new Random().ints(&#39;a&#39;, &#39;z&#39; + 1).limit(10);</b>
<b class="nc">&nbsp;		return chars.collect(StringBuilder::new, StringBuilder::appendCodePoint, StringBuilder::append).toString();</b>
&nbsp;	}
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-01 11:12</div>
</div>
</body>
</html>
